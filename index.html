<!doctype html>
<html lang="th">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Financial Health Checker</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .card-shadow {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .progress-bar {
            transition: width 0.3s ease-in-out;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            .max-w-4xl {
                max-width: 100%;
            }
            
            .px-6 {
                padding-left: 1rem;
                padding-right: 1rem;
            }
            
            .text-4xl {
                font-size: 2rem;
            }
            
            .text-3xl {
                font-size: 1.75rem;
            }
            
            .text-2xl {
                font-size: 1.5rem;
            }
            
            .grid.md\\:grid-cols-2 {
                grid-template-columns: 1fr;
            }
            
            .grid.md\\:grid-cols-3 {
                grid-template-columns: 1fr;
            }
            
            .card-shadow {
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            }
            
            .p-8 {
                padding: 1.5rem;
            }
            
            .py-8 {
                padding-top: 2rem;
                padding-bottom: 2rem;
            }
        }

        @media (max-width: 480px) {
            .text-lg {
                font-size: 1rem;
            }
            
            .px-8 {
                padding-left: 1rem;
                padding-right: 1rem;
            }
            
            .py-4 {
                padding-top: 0.75rem;
                padding-bottom: 0.75rem;
            }
        }
        
        .result-card {
            border-left: 4px solid;
            transition: all 0.3s ease;
        }
        
        .result-card:hover {
            transform: translateY(-2px);
        }
        
        .good { border-color: #10b981; background: linear-gradient(135deg, #ecfdf5, #f0fdf4); }
        .warning { border-color: #f59e0b; background: linear-gradient(135deg, #fffbeb, #fefce8); }
        .danger { border-color: #ef4444; background: linear-gradient(135deg, #fef2f2, #fef2f2); }
        
        .input-field {
            transition: all 0.3s ease;
            border: 2px solid #e5e7eb;
        }
        
        .input-field:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .org-btn {
            padding: 8px 16px;
            border: 2px solid #e5e7eb;
            background: white;
            color: #374151;
            border-radius: 8px;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .org-btn:hover {
            border-color: #667eea;
            background: #f8faff;
            transform: translateY(-1px);
        }
        
        .org-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: #667eea;
        }
        
        .org-btn.selected {
            background: #dbeafe;
            border-color: #3b82f6;
            color: #1e40af;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="min-h-full bg-gray-50">
  <div class="min-h-full"><!-- Header -->
   <header class="gradient-bg text-white py-8">
    <div class="max-w-4xl mx-auto px-6 text-center">
     <h1 id="main-title" class="text-4xl font-bold mb-2">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</h1>
     <p id="subtitle" class="text-xl opacity-90">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏ç</p>
    </div>
   </header><!-- Progress Bar -->
   <div class="bg-white shadow-sm">
    <div class="max-w-4xl mx-auto px-6 py-4">
     <div class="flex items-center justify-between mb-2"><span class="text-sm font-medium text-gray-700">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</span> <span id="progress-text" class="text-sm font-medium text-gray-700">0/5</span>
     </div>
     <div class="w-full bg-gray-200 rounded-full h-2">
      <div id="progress-bar" class="progress-bar bg-gradient-to-r from-blue-500 to-purple-600 h-2 rounded-full" style="width: 0%"></div>
     </div>
    </div>
   </div><!-- Main Content -->
   <main class="max-w-4xl mx-auto px-6 py-8"><!-- Welcome Screen -->
    <div id="welcome-screen" class="text-center fade-in">
     <div class="bg-white rounded-2xl card-shadow p-8 mb-8">
      <div class="text-6xl mb-6">
       üí∞
      </div>
      <h2 class="text-3xl font-bold text-gray-800 mb-4">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</h2>
      <p class="text-lg text-gray-600 mb-8 max-w-2xl mx-auto">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ô 3 ‡∏°‡∏¥‡∏ï‡∏¥‡∏´‡∏•‡∏±‡∏Å: ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏µ‡πâ‡∏ï‡πà‡∏≠‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ (DTI), ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô ‡πÅ‡∏•‡∏∞‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</p><!-- Organization Selection -->
      <div class="max-w-md mx-auto mb-8 space-y-4">
       <h3 class="text-xl font-semibold text-gray-800 mb-4">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h3>
       <div class="flex flex-wrap gap-2 bg-slate-950/20 border border-slate-50/5 rounded-xl p-2"><button id="chooseBranch" class="org-btn active">‡∏™‡∏≤‡∏Ç‡∏≤</button> <button id="chooseHQ" class="org-btn">‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏ç‡πà</button>
       </div><!-- ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏Ç‡∏≤ -->
       <div id="branchGroup" class="space-y-2">
        <p class="text-sm text-gray-600">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏Ñ‡∏Ç‡∏≠‡∏á‡∏™‡∏≤‡∏Ç‡∏≤</p>
        <div class="flex flex-wrap gap-2 justify-center"><button class="org-btn" data-org="BW">BW</button> <button class="org-btn" data-org="BK">BK</button> <button class="org-btn" data-org="ES">ES</button> <button class="org-btn" data-org="EN">EN</button> <button class="org-btn" data-org="CE">CE</button> <button class="org-btn" data-org="CN">CN</button> <button class="org-btn" data-org="NO">NO</button> <button class="org-btn" data-org="SO">SO</button>
        </div>
       </div><!-- ‡∏Å‡∏•‡∏∏‡πà‡∏° HQ -->
       <div id="hqGroup" class="space-y-2 hidden">
        <p class="text-sm text-gray-600">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô (‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏ç‡πà)</p>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-2"><button class="org-btn" data-org="BDSM">BDSM</button> <button class="org-btn" data-org="CLD">CLD</button> <button class="org-btn" data-org="ACC">ACC</button> <button class="org-btn" data-org="CRD">CRD</button> <button class="org-btn" data-org="OPS">OPS</button> <button class="org-btn" data-org="Risk">Risk</button> <button class="org-btn" data-org="HP">HP</button> <button class="org-btn" data-org="Tidlor Academy">Tidlor Academy</button> <button class="org-btn" data-org="BSCS">BSCS</button> <button class="org-btn" data-org="A&amp;D">A&amp;D</button> <button class="org-btn" data-org="IT">IT</button> <button class="org-btn" data-org="INS-Broker">INS-Broker</button> <button class="org-btn" data-org="MKT">MKT</button> <button class="org-btn" data-org="Loan TLS">Loan TLS</button> <button class="org-btn" data-org="Fraud">Fraud</button> <button class="org-btn" data-org="INS-TLS">INS-TLS</button> <button class="org-btn" data-org="Legal">Legal</button> <button class="org-btn" data-org="Compliance">Compliance</button> <button class="org-btn" data-org="IA">IA</button>
        </div>
       </div>
       <div id="selected-org" class="text-sm text-blue-600 font-medium hidden"></div>
      </div><button id="start-btn" class="btn-primary text-white px-8 py-4 rounded-xl font-semibold text-lg disabled:opacity-50 disabled:cursor-not-allowed" disabled> ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô </button>
     </div>
    </div><!-- Question Screens -->
    <div id="question-screen" class="hidden">
     <div class="bg-white rounded-2xl card-shadow p-8 fade-in">
      <h2 id="question-title" class="text-2xl font-bold text-gray-800 mb-6"></h2>
      <div id="question-content"></div>
      <div class="flex justify-between mt-8"><button id="prev-btn" class="px-6 py-3 border border-gray-300 rounded-lg font-medium text-gray-700 hover:bg-gray-50 transition-colors hidden"> ‚Üê ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö </button> <button id="next-btn" class="btn-primary text-white px-8 py-3 rounded-lg font-semibold ml-auto"> ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí </button>
      </div>
     </div>
    </div><!-- Results Screen -->
    <div id="results-screen" class="hidden">
     <div class="space-y-6"><!-- Summary Cards -->
      <div class="grid md:grid-cols-3 gap-6">
       <div id="dti-card" class="result-card rounded-xl p-6">
        <h3 class="font-bold text-lg mb-2">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏µ‡πâ‡∏ï‡πà‡∏≠‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ (DTI)</h3>
        <div id="dti-value" class="text-3xl font-bold mb-2"></div>
        <p id="dti-status" class="text-sm"></p>
       </div>
       <div id="emergency-card" class="result-card rounded-xl p-6">
        <h3 class="font-bold text-lg mb-2">‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô</h3>
        <div id="emergency-value" class="text-3xl font-bold mb-2"></div>
        <p id="emergency-status" class="text-sm"></p>
       </div>
       <div id="liquidity-card" class="result-card rounded-xl p-6">
        <h3 class="font-bold text-lg mb-2">‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á</h3>
        <div id="liquidity-value" class="text-3xl font-bold mb-2"></div>
        <p id="liquidity-status" class="text-sm"></p>
       </div>
      </div><!-- Detailed Analysis -->
      <div class="bg-white rounded-2xl card-shadow p-8">
       <h3 class="text-2xl font-bold text-gray-800 mb-6">‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h3>
       <div id="recommendations" class="space-y-6"></div>
      </div><!-- Interactive Adjustment -->
      <div id="adjustment-section" class="bg-white rounded-2xl card-shadow p-8">
       <h3 class="text-2xl font-bold text-gray-800 mb-6">üìä ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</h3>
       <p class="text-gray-600 mb-6">‡∏•‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏ï‡πà‡∏≠‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</p>
       <div id="adjustment-content"></div>
      </div><!-- Emergency Fund Simulator -->
      <div id="emergency-simulator" class="bg-white rounded-2xl card-shadow p-8 hidden">
       <h3 class="text-2xl font-bold text-gray-800 mb-6">üí∞ ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô</h3>
       <p class="text-gray-600 mb-6">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô‡πÉ‡∏´‡πâ‡∏ñ‡∏∂‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</p>
       <div class="grid md:grid-cols-2 gap-6">
        <div class="space-y-4">
         <div><label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡πÑ‡∏ß‡πâ (‡∏ö‡∏≤‡∏ó)</label> <input type="text" id="monthly-saving-input" class="input-field w-full px-4 py-3 rounded-lg text-lg" placeholder="‡πÄ‡∏ä‡πà‡∏ô 5,000">
         </div>
         <div class="bg-blue-50 p-4 rounded-lg">
          <h4 class="font-bold text-lg mb-2">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô</h4>
          <div class="space-y-2 text-sm">
           <div class="flex justify-between"><span>3 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</span> <span id="target-3-months" class="font-bold"></span>
           </div>
           <div class="flex justify-between"><span>6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</span> <span id="target-6-months" class="font-bold"></span>
           </div>
          </div>
         </div>
        </div>
        <div class="space-y-4">
         <div class="bg-gradient-to-r from-green-50 to-blue-50 p-4 rounded-lg">
          <h4 class="font-bold text-lg mb-3">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ</h4>
          <div class="space-y-3">
           <div class="flex justify-between items-center"><span class="text-sm">‡∏ñ‡∏∂‡∏á‡πÄ‡∏õ‡πâ‡∏≤ 3 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</span>
            <div class="text-right">
             <div id="time-to-3-months" class="font-bold text-lg text-green-600"></div>
             <div id="date-to-3-months" class="text-xs text-gray-600"></div>
            </div>
           </div>
           <div class="flex justify-between items-center"><span class="text-sm">‡∏ñ‡∏∂‡∏á‡πÄ‡∏õ‡πâ‡∏≤ 6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</span>
            <div class="text-right">
             <div id="time-to-6-months" class="font-bold text-lg text-blue-600"></div>
             <div id="date-to-6-months" class="text-xs text-gray-600"></div>
            </div>
           </div>
          </div>
         </div>
         <div class="bg-yellow-50 p-4 rounded-lg">
          <h5 class="font-bold text-sm mb-2">üí° ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°</h5>
          <ul class="text-xs space-y-1 text-gray-700">
           <li>‚Ä¢ ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏≠‡∏≠‡∏°‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 10-20% ‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</li>
           <li>‚Ä¢ ‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ "‡∏à‡πà‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô" ‡πÇ‡∏î‡∏¢‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</li>
           <li>‚Ä¢ ‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏≠‡∏≠‡∏°‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡πÅ‡∏¢‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô</li>
          </ul>
         </div>
        </div>
       </div>
      </div><!-- Action Buttons -->
      <div class="text-center"><button id="restart-btn" class="btn-primary text-white px-8 py-3 rounded-lg font-semibold"> üîÑ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡∏°‡πà </button>
      </div>
     </div>
    </div>
   </main>
  </div>
  <script>
        // Configuration
        const defaultConfig = {
            main_title: "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô",
            subtitle: "‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏ç",
            start_button_text: "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô"
        };

        // Application state
        let currentStep = 0;
        let selectedOrganization = '';
        let userData = {
            income: 0,
            debtPayment: 0,
            expenses: {
                food: 0,
                transport: 0,
                household: 0,
                utilities: 0,
                entertainment: 0,
                clothing: 0,
                communication: 0,
                other: 0
            },
            savings: 0
        };

        // Number formatting functions
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        function parseNumber(str) {
            return parseFloat(str.replace(/,/g, '')) || 0;
        }

        function formatMonthsToYears(months) {
            if (months <= 0) return '‡∏ñ‡∏∂‡∏á‡πÅ‡∏•‡πâ‡∏ß!';
            
            const years = Math.floor(months / 12);
            const remainingMonths = months % 12;
            
            if (years === 0) {
                return `${months} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô`;
            } else if (remainingMonths === 0) {
                return `${years} ‡∏õ‡∏µ`;
            } else {
                return `${years} ‡∏õ‡∏µ ${remainingMonths} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô`;
            }
        }

        function setupNumberInput(input) {
            // Change input type to text to allow formatting
            input.type = 'text';
            
            input.addEventListener('input', function(e) {
                // Get cursor position before formatting
                const cursorPosition = e.target.selectionStart;
                const oldValue = e.target.value;
                const oldLength = oldValue.length;
                
                // Remove all commas and non-numeric characters except digits
                let value = e.target.value.replace(/[^0-9]/g, '');
                
                if (value) {
                    // Format with commas
                    const formattedValue = formatNumber(value);
                    e.target.value = formattedValue;
                    
                    // Calculate new cursor position
                    const newLength = formattedValue.length;
                    const lengthDiff = newLength - oldLength;
                    const newCursorPosition = Math.max(0, cursorPosition + lengthDiff);
                    
                    // Set cursor position
                    setTimeout(() => {
                        e.target.setSelectionRange(newCursorPosition, newCursorPosition);
                    }, 0);
                } else {
                    e.target.value = '';
                }
            });
            
            // Handle paste events
            input.addEventListener('paste', function(e) {
                e.preventDefault();
                const pastedText = (e.clipboardData || window.clipboardData).getData('text');
                let value = pastedText.replace(/[^0-9]/g, '');
                if (value) {
                    e.target.value = formatNumber(value);
                }
            });
            
            // Handle focus to show formatted value
            input.addEventListener('focus', function(e) {
                if (e.target.value) {
                    const value = e.target.value.replace(/[^0-9]/g, '');
                    if (value) {
                        e.target.value = formatNumber(value);
                    }
                }
            });
        }

        // Questions configuration
        const questions = [
            {
                title: "‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô",
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-600">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏ö‡∏≤‡∏ó)</p>
                        <input type="text" id="income-input" class="input-field w-full px-4 py-3 rounded-lg text-lg" placeholder="‡πÄ‡∏ä‡πà‡∏ô 50,000" inputmode="numeric">
                    </div>
                `,
                field: 'income'
            },
            {
                title: "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏´‡∏ô‡∏µ‡πâ‡∏£‡∏ß‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô",
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-600">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢‡∏´‡∏ô‡∏µ‡πâ‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏ö‡∏≤‡∏ó)</p>
                        <input type="text" id="debt-input" class="input-field w-full px-4 py-3 rounded-lg text-lg" placeholder="‡πÄ‡∏ä‡πà‡∏ô 15,000" inputmode="numeric">
                    </div>
                `,
                field: 'debtPayment'
            },
            {
                title: "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô",
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-600 mb-6">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏ö‡∏≤‡∏ó)</p>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£</label>
                                <input type="text" id="food-input" class="input-field w-full px-3 py-2 rounded-lg" placeholder="0" inputmode="numeric">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á/‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô</label>
                                <input type="text" id="transport-input" class="input-field w-full px-3 py-2 rounded-lg" placeholder="0" inputmode="numeric">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô</label>
                                <input type="text" id="household-input" class="input-field w-full px-3 py-2 rounded-lg" placeholder="0" inputmode="numeric">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥/‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü</label>
                                <input type="text" id="utilities-input" class="input-field w-full px-3 py-2 rounded-lg" placeholder="0" inputmode="numeric">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Ñ‡πà‡∏≤‡∏ô‡∏±‡∏ô‡∏ó‡∏ô‡∏≤‡∏Å‡∏≤‡∏£/‡∏™‡∏±‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå</label>
                                <input type="text" id="entertainment-input" class="input-field w-full px-3 py-2 rounded-lg" placeholder="0" inputmode="numeric">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏î‡∏±‡∏ö</label>
                                <input type="text" id="clothing-input" class="input-field w-full px-3 py-2 rounded-lg" placeholder="0" inputmode="numeric">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Ñ‡πà‡∏≤‡πÄ‡∏ô‡πá‡∏ï/‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                                <input type="text" id="communication-input" class="input-field w-full px-3 py-2 rounded-lg" placeholder="0" inputmode="numeric">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</label>
                                <input type="text" id="other-input" class="input-field w-full px-3 py-2 rounded-lg" placeholder="0" inputmode="numeric">
                            </div>
                        </div>
                    </div>
                `,
                field: 'expenses'
            },
            {
                title: "‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°‡∏£‡∏ß‡∏°‡πÉ‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô",
                content: `
                    <div class="space-y-4">
                        <p class="text-gray-600">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°‡∏£‡∏ß‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡πÉ‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏ö‡∏≤‡∏ó)</p>
                        <input type="text" id="savings-input" class="input-field w-full px-4 py-3 rounded-lg text-lg" placeholder="‡πÄ‡∏ä‡πà‡∏ô 100,000" inputmode="numeric">
                    </div>
                `,
                field: 'savings'
            }
        ];

        // Initialize app
        function init() {
            setupEventListeners();
            updateProgress();
        }

        function setupEventListeners() {
            document.getElementById('start-btn').addEventListener('click', startQuestionnaire);
            document.getElementById('next-btn').addEventListener('click', nextQuestion);
            document.getElementById('prev-btn').addEventListener('click', prevQuestion);
            document.getElementById('restart-btn').addEventListener('click', restart);
            
            // Organization selection listeners
            document.getElementById('chooseBranch').addEventListener('click', () => switchOrgType('branch'));
            document.getElementById('chooseHQ').addEventListener('click', () => switchOrgType('hq'));
            
            // Organization buttons listeners
            document.querySelectorAll('[data-org]').forEach(btn => {
                btn.addEventListener('click', (e) => selectOrganization(e.target.dataset.org));
            });
        }
        
        function switchOrgType(type) {
            const chooseBranchBtn = document.getElementById('chooseBranch');
            const chooseHQBtn = document.getElementById('chooseHQ');
            const branchGroup = document.getElementById('branchGroup');
            const hqGroup = document.getElementById('hqGroup');
            
            if (type === 'branch') {
                chooseBranchBtn.classList.add('active');
                chooseHQBtn.classList.remove('active');
                branchGroup.classList.remove('hidden');
                hqGroup.classList.add('hidden');
            } else {
                chooseHQBtn.classList.add('active');
                chooseBranchBtn.classList.remove('active');
                hqGroup.classList.remove('hidden');
                branchGroup.classList.add('hidden');
            }
            
            // Clear previous selection
            clearOrgSelection();
        }
        
        function selectOrganization(org) {
            selectedOrganization = org;
            
            // Clear all selected states
            document.querySelectorAll('[data-org]').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Add selected state to clicked button
            document.querySelector(`[data-org="${org}"]`).classList.add('selected');
            
            // Show selected organization
            const selectedOrgDiv = document.getElementById('selected-org');
            selectedOrgDiv.textContent = `‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß: ${org}`;
            selectedOrgDiv.classList.remove('hidden');
            
            // Enable start button
            document.getElementById('start-btn').disabled = false;
        }
        
        function clearOrgSelection() {
            selectedOrganization = '';
            document.querySelectorAll('[data-org]').forEach(btn => {
                btn.classList.remove('selected');
            });
            document.getElementById('selected-org').classList.add('hidden');
            document.getElementById('start-btn').disabled = true;
        }

        function startQuestionnaire() {
            document.getElementById('welcome-screen').classList.add('hidden');
            document.getElementById('question-screen').classList.remove('hidden');
            showQuestion(0);
        }

        function showQuestion(step) {
            currentStep = step;
            const question = questions[step];
            
            document.getElementById('question-title').textContent = question.title;
            document.getElementById('question-content').innerHTML = question.content;
            
            // Show/hide navigation buttons
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            
            if (step === 0) {
                prevBtn.classList.add('hidden');
            } else {
                prevBtn.classList.remove('hidden');
            }
            
            if (step === questions.length - 1) {
                nextBtn.textContent = '‡∏î‡∏π‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå';
            } else {
                nextBtn.textContent = '‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí';
            }
            
            // Load existing data
            loadQuestionData(step);
            updateProgress();
        }

        function loadQuestionData(step) {
            const question = questions[step];
            
            // Setup number formatting for all inputs after DOM is ready
            setTimeout(() => {
                const inputs = document.querySelectorAll('input[type="number"], input[type="text"]');
                inputs.forEach(input => {
                    if (input.id.includes('-input')) {
                        setupNumberInput(input);
                    }
                });
            }, 100);
            
            if (question.field === 'income') {
                const input = document.getElementById('income-input');
                if (userData.income > 0) input.value = formatNumber(userData.income);
            } else if (question.field === 'debtPayment') {
                const input = document.getElementById('debt-input');
                if (userData.debtPayment > 0) input.value = formatNumber(userData.debtPayment);
            } else if (question.field === 'expenses') {
                Object.keys(userData.expenses).forEach(key => {
                    const input = document.getElementById(`${key}-input`);
                    if (input && userData.expenses[key] > 0) {
                        input.value = formatNumber(userData.expenses[key]);
                    }
                });
            } else if (question.field === 'savings') {
                const input = document.getElementById('savings-input');
                if (userData.savings > 0) input.value = formatNumber(userData.savings);
            }
        }

        function saveQuestionData(step) {
            const question = questions[step];
            
            if (question.field === 'income') {
                const value = parseNumber(document.getElementById('income-input').value);
                userData.income = value;
            } else if (question.field === 'debtPayment') {
                const value = parseNumber(document.getElementById('debt-input').value);
                userData.debtPayment = value;
            } else if (question.field === 'expenses') {
                Object.keys(userData.expenses).forEach(key => {
                    const input = document.getElementById(`${key}-input`);
                    if (input) {
                        userData.expenses[key] = parseNumber(input.value);
                    }
                });
            } else if (question.field === 'savings') {
                const value = parseNumber(document.getElementById('savings-input').value);
                userData.savings = value;
            }
        }

        function nextQuestion() {
            saveQuestionData(currentStep);
            
            if (currentStep < questions.length - 1) {
                showQuestion(currentStep + 1);
            } else {
                showResults();
            }
        }

        function prevQuestion() {
            saveQuestionData(currentStep);
            if (currentStep > 0) {
                showQuestion(currentStep - 1);
            }
        }

        function updateProgress() {
            const progress = ((currentStep + 1) / (questions.length + 1)) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
            document.getElementById('progress-text').textContent = `${currentStep + 1}/${questions.length + 1}`;
        }

        function showResults() {
            document.getElementById('question-screen').classList.add('hidden');
            document.getElementById('results-screen').classList.remove('hidden');
            
            const results = calculateResults();
            displayResults(results);
            
            // Always show emergency simulator
            document.getElementById('emergency-simulator').classList.remove('hidden');
            setupEmergencySimulator(results);
            
            createAdjustmentSection();
            
            // Update progress to show completion (5/5)
            currentStep = questions.length;
            updateProgress();
        }

        function calculateResults() {
            const totalExpenses = Object.values(userData.expenses).reduce((sum, val) => sum + val, 0);
            const totalMonthlyExpenses = userData.debtPayment + totalExpenses;
            
            // DTI Calculation
            const dti = userData.income > 0 ? (userData.debtPayment / userData.income) * 100 : 0;
            
            // Emergency Fund Calculation (months of coverage)
            const emergencyMonths = totalMonthlyExpenses > 0 ? userData.savings / totalMonthlyExpenses : 0;
            
            // Liquidity Calculation
            const liquidity = userData.income - totalMonthlyExpenses;
            
            return {
                dti,
                emergencyMonths,
                liquidity,
                totalExpenses,
                totalMonthlyExpenses
            };
        }

        function displayResults(results) {
            // DTI Card
            const dtiCard = document.getElementById('dti-card');
            const dtiValue = document.getElementById('dti-value');
            const dtiStatus = document.getElementById('dti-status');
            
            dtiValue.textContent = `${results.dti.toFixed(1)}%`;
            
            if (results.dti <= 35) {
                dtiCard.className = 'result-card rounded-xl p-6 good';
                dtiStatus.textContent = '‡∏î‡∏µ‡∏°‡∏≤‡∏Å! ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢';
            } else if (results.dti <= 45) {
                dtiCard.className = 'result-card rounded-xl p-6 warning';
                dtiStatus.textContent = '‡∏£‡∏∞‡∏°‡∏±‡∏î‡∏£‡∏∞‡∏ß‡∏±‡∏á! ‡∏Ñ‡∏ß‡∏£‡∏´‡∏¢‡∏∏‡∏î‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡πà‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ';
            } else {
                dtiCard.className = 'result-card rounded-xl p-6 danger';
                dtiStatus.textContent = '‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢! ‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏¢‡∏∏‡∏î‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡∏∞‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡∏µ‡πâ';
            }
            
            // Emergency Fund Card
            const emergencyCard = document.getElementById('emergency-card');
            const emergencyValue = document.getElementById('emergency-value');
            const emergencyStatus = document.getElementById('emergency-status');
            
            emergencyValue.textContent = `${results.emergencyMonths.toFixed(1)} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô`;
            
            if (results.emergencyMonths >= 3 && results.emergencyMonths <= 6) {
                emergencyCard.className = 'result-card rounded-xl p-6 good';
                emergencyStatus.textContent = '‡∏î‡∏µ‡∏°‡∏≤‡∏Å! ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°';
            } else if (results.emergencyMonths < 3) {
                emergencyCard.className = 'result-card rounded-xl p-6 warning';
                emergencyStatus.textContent = '‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ñ‡∏∂‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ 3-6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô';
            } else {
                emergencyCard.className = 'result-card rounded-xl p-6 warning';
                emergencyStatus.textContent = '‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏õ‡πâ‡∏≤ ‡∏Ñ‡∏ß‡∏£‡∏ô‡∏≥‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡∏•‡∏á‡∏ó‡∏∏‡∏ô';
            }
            
            // Liquidity Card
            const liquidityCard = document.getElementById('liquidity-card');
            const liquidityValue = document.getElementById('liquidity-value');
            const liquidityStatus = document.getElementById('liquidity-status');
            
            liquidityValue.textContent = `${results.liquidity.toLocaleString()} ‡∏ö‡∏≤‡∏ó`;
            
            if (results.liquidity >= 0) {
                liquidityCard.className = 'result-card rounded-xl p-6 good';
                liquidityStatus.textContent = '‡∏î‡∏µ‡∏°‡∏≤‡∏Å! ‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ö‡∏ß‡∏Å';
            } else {
                liquidityCard.className = 'result-card rounded-xl p-6 danger';
                liquidityStatus.textContent = '‡∏ï‡∏¥‡∏î‡∏•‡∏ö! ‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ';
            }
            
            // Recommendations
            generateRecommendations(results);
        }

        function generateRecommendations(results) {
            const recommendationsDiv = document.getElementById('recommendations');
            let recommendations = [];
            
            // DTI Recommendations
            if (results.dti <= 35) {
                recommendations.push({
                    title: 'üéâ ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏µ‡πâ‡∏î‡∏µ‡∏°‡∏≤‡∏Å',
                    content: '‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏µ‡πâ‡∏ï‡πà‡∏≠‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏´‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡∏î‡∏µ‡πÅ‡∏•‡∏∞‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏°‡πÅ‡∏•‡∏∞‡∏•‡∏á‡∏ó‡∏∏‡∏ô',
                    type: 'good'
                });
            } else if (results.dti <= 45) {
                recommendations.push({
                    title: '‚ö†Ô∏è ‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏°‡∏±‡∏î‡∏£‡∏∞‡∏ß‡∏±‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏ô‡∏µ‡πâ',
                    content: '‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏π‡∏á ‡∏Ñ‡∏ß‡∏£‡∏´‡∏¢‡∏∏‡∏î‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡πà‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡∏´‡∏°‡∏î ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡∏†‡∏≤‡∏£‡∏∞‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô',
                    type: 'warning'
                });
            } else {
                recommendations.push({
                    title: 'üö® ‡∏´‡∏ô‡∏µ‡πâ‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ',
                    content: '‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å ‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏¢‡∏∏‡∏î‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡∏µ‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÄ‡∏£‡πà‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ ‡πÅ‡∏•‡∏∞‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÄ‡∏à‡∏£‡∏à‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡∏µ‡πâ‡∏´‡∏≤‡∏Å‡∏à‡πà‡∏≤‡∏¢‡πÑ‡∏°‡πà‡πÑ‡∏´‡∏ß',
                    type: 'danger'
                });
            }
            
            // Emergency Fund Recommendations
            if (results.emergencyMonths < 3) {
                recommendations.push({
                    title: 'üí∞ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô',
                    content: `‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á ${results.emergencyMonths.toFixed(1)} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡πâ‡∏ñ‡∏∂‡∏á 3-6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô`,
                    type: 'warning'
                });
            } else if (results.emergencyMonths > 6) {
                recommendations.push({
                    title: 'üìà ‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô',
                    content: '‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ ‡∏Ñ‡∏ß‡∏£‡∏ô‡∏≥‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏ô 6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÑ‡∏õ‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï',
                    type: 'good'
                });
            }
            
            // Liquidity Recommendations
            if (results.liquidity < 0) {
                const topExpenses = getTopExpenses();
                recommendations.push({
                    title: 'üìâ ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á',
                    content: `‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏¥‡∏î‡∏•‡∏ö ${Math.abs(results.liquidity).toLocaleString()} ‡∏ö‡∏≤‡∏ó ‡∏Ñ‡∏ß‡∏£‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î: ${topExpenses.join(', ')}`,
                    type: 'danger'
                });
            }
            
            // Display recommendations
            recommendationsDiv.innerHTML = recommendations.map(rec => `
                <div class="result-card rounded-lg p-6 ${rec.type}">
                    <h4 class="font-bold text-lg mb-2">${rec.title}</h4>
                    <p class="text-gray-700">${rec.content}</p>
                </div>
            `).join('');
        }

        function getTopExpenses() {
            const expenseLabels = {
                food: '‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£',
                transport: '‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á',
                household: '‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô',
                utilities: '‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥/‡πÑ‡∏ü',
                entertainment: '‡∏Ñ‡πà‡∏≤‡∏ô‡∏±‡∏ô‡∏ó‡∏ô‡∏≤‡∏Å‡∏≤‡∏£',
                clothing: '‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤',
                communication: '‡∏Ñ‡πà‡∏≤‡πÄ‡∏ô‡πá‡∏ï/‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå',
                other: '‡∏≠‡∏∑‡πà‡∏ô‡πÜ'
            };
            
            return Object.entries(userData.expenses)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 3)
                .filter(([,value]) => value > 0)
                .map(([key]) => expenseLabels[key]);
        }

        function setupEmergencySimulator(results) {
            const monthlyInput = document.getElementById('monthly-saving-input');
            const target3El = document.getElementById('target-3-months');
            const target6El = document.getElementById('target-6-months');
            
            const target3Months = results.totalMonthlyExpenses * 3;
            const target6Months = results.totalMonthlyExpenses * 6;
            
            target3El.textContent = formatNumber(target3Months) + ' ‡∏ö‡∏≤‡∏ó';
            target6El.textContent = formatNumber(target6Months) + ' ‡∏ö‡∏≤‡∏ó';
            
            setupNumberInput(monthlyInput);
            
            function updateSimulation() {
                const monthlySaving = parseNumber(monthlyInput.value);
                if (monthlySaving <= 0) return;
                
                const currentSavings = userData.savings;
                const needed3Months = Math.max(0, target3Months - currentSavings);
                const needed6Months = Math.max(0, target6Months - currentSavings);
                
                const months3 = Math.ceil(needed3Months / monthlySaving);
                const months6 = Math.ceil(needed6Months / monthlySaving);
                
                // Update time displays
                document.getElementById('time-to-3-months').textContent = formatMonthsToYears(months3);
                document.getElementById('time-to-6-months').textContent = formatMonthsToYears(months6);
                
                // Calculate target dates
                const today = new Date();
                const date3Months = new Date(today);
                const date6Months = new Date(today);
                date3Months.setMonth(date3Months.getMonth() + months3);
                date6Months.setMonth(date6Months.getMonth() + months6);
                
                document.getElementById('date-to-3-months').textContent = 
                    months3 <= 0 ? '' : date3Months.toLocaleDateString('th-TH');
                document.getElementById('date-to-6-months').textContent = 
                    months6 <= 0 ? '' : date6Months.toLocaleDateString('th-TH');
            }
            
            monthlyInput.addEventListener('input', updateSimulation);
            
            // Set default value (10% of income)
            const suggestedSaving = Math.round(userData.income * 0.1);
            monthlyInput.value = formatNumber(suggestedSaving);
            updateSimulation();
        }



        function createAdjustmentSection() {
            const adjustmentContent = document.getElementById('adjustment-content');
            const expenseLabels = {
                food: '‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£',
                transport: '‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á/‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô',
                household: '‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô',
                utilities: '‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥/‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü',
                entertainment: '‡∏Ñ‡πà‡∏≤‡∏ô‡∏±‡∏ô‡∏ó‡∏ô‡∏≤‡∏Å‡∏≤‡∏£/‡∏™‡∏±‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå',
                clothing: '‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏î‡∏±‡∏ö',
                communication: '‡∏Ñ‡πà‡∏≤‡πÄ‡∏ô‡πá‡∏ï/‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå',
                other: '‡∏≠‡∏∑‡πà‡∏ô‡πÜ'
            };
            
            let html = `
                <!-- Income & Debt Adjustment Section -->
                <div class="grid md:grid-cols-2 gap-6 mb-8">
                    <div class="bg-green-50 p-6 rounded-xl border-l-4 border-green-500">
                        <h4 class="font-bold text-lg mb-4 text-green-800">üí∞ ‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</h4>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</label>
                                <div class="text-2xl font-bold text-green-600 mb-2">${formatNumber(userData.income)} ‡∏ö‡∏≤‡∏ó</div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô</label>
                                <input type="text" id="adj-income" class="input-field w-full px-3 py-2 rounded-lg" 
                                       value="${formatNumber(userData.income)}" onchange="updateAdjustment()">
                                <div class="text-xs text-gray-600 mt-1">‡πÄ‡∏ä‡πà‡∏ô ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏£‡∏¥‡∏°, ‡πÇ‡∏ö‡∏ô‡∏±‡∏™, ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-red-50 p-6 rounded-xl border-l-4 border-red-500">
                        <h4 class="font-bold text-lg mb-4 text-red-800">üí≥ ‡∏õ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏´‡∏ô‡∏µ‡πâ</h4>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡πà‡∏≤‡∏¢‡∏´‡∏ô‡∏µ‡πâ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</label>
                                <div class="text-2xl font-bold text-red-600 mb-2">${formatNumber(userData.debtPayment)} ‡∏ö‡∏≤‡∏ó</div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡πà‡∏≤‡∏¢‡∏´‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô</label>
                                <input type="text" id="adj-debt" class="input-field w-full px-3 py-2 rounded-lg" 
                                       value="${formatNumber(userData.debtPayment)}" onchange="updateAdjustment()">
                                <div class="text-xs text-gray-600 mt-1">‡πÄ‡∏ä‡πà‡∏ô ‡∏õ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡∏µ‡πâ, ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°, ‡∏£‡∏ß‡∏°‡∏´‡∏ô‡∏µ‡πâ</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Expenses Adjustment Section -->
                <div class="bg-white border rounded-xl p-6 mb-6">
                    <h4 class="font-bold text-lg mb-4 text-gray-800">üõí ‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h4>
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <h5 class="font-medium text-gray-700 mb-3">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</h5>
                            <div class="space-y-2">
            `;
            
            Object.entries(userData.expenses).forEach(([key, value]) => {
                if (value > 0) {
                    html += `
                        <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                            <span class="text-sm">${expenseLabels[key]}</span>
                            <span class="font-bold text-sm">${formatNumber(value)} ‡∏ö‡∏≤‡∏ó</span>
                        </div>
                    `;
                }
            });
            
            html += `
                            </div>
                        </div>
                        <div>
                            <h5 class="font-medium text-gray-700 mb-3">‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà</h5>
                            <div class="space-y-2">
            `;
            
            Object.entries(userData.expenses).forEach(([key, value]) => {
                if (value > 0) {
                    html += `
                        <div class="flex justify-between items-center p-2 bg-blue-50 rounded">
                            <span class="text-sm font-medium">${expenseLabels[key]}</span>
                            <input type="text" id="adj-${key}" class="input-field w-24 px-2 py-1 text-right text-sm rounded" 
                                   value="${formatNumber(value)}" onchange="updateAdjustment()">
                        </div>
                    `;
                }
            });
            
            html += `
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Results Section -->
                <div class="bg-gradient-to-r from-blue-50 to-purple-50 p-6 rounded-xl border">
                    <h4 class="font-bold text-xl mb-4 text-center">üìä ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏´‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</h4>
                    
                    <!-- Key Metrics -->
                    <div class="grid md:grid-cols-4 gap-4 mb-6">
                        <div class="text-center p-4 bg-white rounded-lg shadow-sm">
                            <div class="text-xs text-gray-600 mb-1">‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</div>
                            <div id="new-liquidity" class="text-lg font-bold"></div>
                            <div id="liquidity-change" class="text-xs mt-1"></div>
                        </div>
                        <div class="text-center p-4 bg-white rounded-lg shadow-sm">
                            <div class="text-xs text-gray-600 mb-1">DTI ‡πÉ‡∏´‡∏°‡πà</div>
                            <div id="new-dti" class="text-lg font-bold"></div>
                            <div id="dti-change" class="text-xs mt-1"></div>
                        </div>
                        <div class="text-center p-4 bg-white rounded-lg shadow-sm">
                            <div class="text-xs text-gray-600 mb-1">‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô</div>
                            <div id="new-emergency" class="text-lg font-bold"></div>
                            <div id="emergency-change" class="text-xs mt-1"></div>
                        </div>
                        <div class="text-center p-4 bg-white rounded-lg shadow-sm">
                            <div class="text-xs text-gray-600 mb-1">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏£‡∏ß‡∏°</div>
                            <div id="total-change" class="text-lg font-bold"></div>
                            <div class="text-xs text-gray-600 mt-1">‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
                        </div>
                    </div>

                    <!-- Detailed Changes -->
                    <div class="grid md:grid-cols-3 gap-4">
                        <div class="bg-green-100 p-4 rounded-lg">
                            <h5 class="font-bold text-green-800 mb-2">üíπ ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</h5>
                            <div id="income-change-detail" class="text-sm"></div>
                        </div>
                        <div class="bg-red-100 p-4 rounded-lg">
                            <h5 class="font-bold text-red-800 mb-2">üí≥ ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏´‡∏ô‡∏µ‡πâ</h5>
                            <div id="debt-change-detail" class="text-sm"></div>
                        </div>
                        <div class="bg-blue-100 p-4 rounded-lg">
                            <h5 class="font-bold text-blue-800 mb-2">üõí ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</h5>
                            <div id="expense-change-detail" class="text-sm"></div>
                        </div>
                    </div>

                    <!-- Recommendations -->
                    <div id="adjustment-recommendations" class="mt-6 p-4 bg-white rounded-lg border-l-4 border-yellow-500">
                        <h5 class="font-bold text-yellow-800 mb-2">üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h5>
                        <div id="recommendation-content" class="text-sm text-gray-700"></div>
                    </div>
                </div>
            `;
            
            adjustmentContent.innerHTML = html;
            
            // Setup number formatting for adjustment inputs
            setTimeout(() => {
                const adjIncomeInput = document.getElementById('adj-income');
                const adjDebtInput = document.getElementById('adj-debt');
                
                if (adjIncomeInput) setupNumberInput(adjIncomeInput);
                if (adjDebtInput) setupNumberInput(adjDebtInput);
                
                Object.keys(userData.expenses).forEach(key => {
                    const adjInput = document.getElementById(`adj-${key}`);
                    if (adjInput) {
                        setupNumberInput(adjInput);
                    }
                });
            }, 100);
            
            updateAdjustment();
        }

        function updateAdjustment() {
            // Get new values
            const newIncome = parseNumber(document.getElementById('adj-income')?.value || userData.income);
            const newDebtPayment = parseNumber(document.getElementById('adj-debt')?.value || userData.debtPayment);
            
            let newTotalExpenses = 0;
            let originalTotalExpenses = 0;
            
            Object.keys(userData.expenses).forEach(key => {
                const originalValue = userData.expenses[key];
                const adjInput = document.getElementById(`adj-${key}`);
                
                if (adjInput) {
                    const newValue = parseNumber(adjInput.value);
                    newTotalExpenses += newValue;
                }
                originalTotalExpenses += originalValue;
            });
            
            // Calculate new metrics
            const newTotalMonthlyExpenses = newDebtPayment + newTotalExpenses;
            const newLiquidity = newIncome - newTotalMonthlyExpenses;
            const newDTI = newIncome > 0 ? (newDebtPayment / newIncome) * 100 : 0;
            const newEmergencyMonths = newTotalMonthlyExpenses > 0 ? userData.savings / newTotalMonthlyExpenses : 0;
            
            // Calculate changes
            const originalTotalMonthlyExpenses = userData.debtPayment + originalTotalExpenses;
            const originalLiquidity = userData.income - originalTotalMonthlyExpenses;
            const originalDTI = userData.income > 0 ? (userData.debtPayment / userData.income) * 100 : 0;
            const originalEmergencyMonths = originalTotalMonthlyExpenses > 0 ? userData.savings / originalTotalMonthlyExpenses : 0;
            
            const incomeChange = newIncome - userData.income;
            const debtChange = newDebtPayment - userData.debtPayment;
            const expenseChange = newTotalExpenses - originalTotalExpenses;
            const liquidityChange = newLiquidity - originalLiquidity;
            const dtiChange = newDTI - originalDTI;
            const emergencyChange = newEmergencyMonths - originalEmergencyMonths;
            const totalChange = incomeChange - debtChange - expenseChange;
            
            // Update main metrics display
            const newLiquidityEl = document.getElementById('new-liquidity');
            const newDTIEl = document.getElementById('new-dti');
            const newEmergencyEl = document.getElementById('new-emergency');
            const totalChangeEl = document.getElementById('total-change');
            
            if (newLiquidityEl) {
                newLiquidityEl.textContent = `${newLiquidity.toLocaleString()} ‡∏ö‡∏≤‡∏ó`;
                newLiquidityEl.className = `text-lg font-bold ${newLiquidity >= 0 ? 'text-green-600' : 'text-red-600'}`;
            }
            
            if (newDTIEl) {
                newDTIEl.textContent = `${newDTI.toFixed(1)}%`;
                newDTIEl.className = `text-lg font-bold ${newDTI <= 35 ? 'text-green-600' : newDTI <= 45 ? 'text-orange-600' : 'text-red-600'}`;
            }
            
            if (newEmergencyEl) {
                newEmergencyEl.textContent = `${newEmergencyMonths.toFixed(1)} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô`;
                newEmergencyEl.className = `text-lg font-bold ${newEmergencyMonths >= 3 && newEmergencyMonths <= 6 ? 'text-green-600' : 'text-orange-600'}`;
            }
            
            if (totalChangeEl) {
                totalChangeEl.textContent = `${totalChange >= 0 ? '+' : ''}${totalChange.toLocaleString()} ‡∏ö‡∏≤‡∏ó`;
                totalChangeEl.className = `text-lg font-bold ${totalChange >= 0 ? 'text-green-600' : 'text-red-600'}`;
            }
            
            // Update change indicators
            const liquidityChangeEl = document.getElementById('liquidity-change');
            const dtiChangeEl = document.getElementById('dti-change');
            const emergencyChangeEl = document.getElementById('emergency-change');
            
            if (liquidityChangeEl) {
                liquidityChangeEl.textContent = `${liquidityChange >= 0 ? '+' : ''}${liquidityChange.toLocaleString()} ‡∏ö‡∏≤‡∏ó`;
                liquidityChangeEl.className = `text-xs mt-1 ${liquidityChange >= 0 ? 'text-green-600' : 'text-red-600'}`;
            }
            
            if (dtiChangeEl) {
                dtiChangeEl.textContent = `${dtiChange >= 0 ? '+' : ''}${dtiChange.toFixed(1)}%`;
                dtiChangeEl.className = `text-xs mt-1 ${dtiChange <= 0 ? 'text-green-600' : 'text-red-600'}`;
            }
            
            if (emergencyChangeEl) {
                emergencyChangeEl.textContent = `${emergencyChange >= 0 ? '+' : ''}${emergencyChange.toFixed(1)} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô`;
                emergencyChangeEl.className = `text-xs mt-1 ${emergencyChange >= 0 ? 'text-green-600' : 'text-red-600'}`;
            }
            
            // Update detailed changes
            const incomeChangeDetailEl = document.getElementById('income-change-detail');
            const debtChangeDetailEl = document.getElementById('debt-change-detail');
            const expenseChangeDetailEl = document.getElementById('expense-change-detail');
            
            if (incomeChangeDetailEl) {
                if (incomeChange === 0) {
                    incomeChangeDetailEl.innerHTML = '<div class="text-gray-600">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á</div>';
                } else {
                    incomeChangeDetailEl.innerHTML = `
                        <div class="flex justify-between mb-1">
                            <span>‡πÄ‡∏î‡∏¥‡∏°:</span>
                            <span>${formatNumber(userData.income)} ‡∏ö‡∏≤‡∏ó</span>
                        </div>
                        <div class="flex justify-between mb-1">
                            <span>‡πÉ‡∏´‡∏°‡πà:</span>
                            <span>${formatNumber(newIncome)} ‡∏ö‡∏≤‡∏ó</span>
                        </div>
                        <div class="flex justify-between font-bold ${incomeChange >= 0 ? 'text-green-700' : 'text-red-700'}">
                            <span>‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á:</span>
                            <span>${incomeChange >= 0 ? '+' : ''}${formatNumber(incomeChange)} ‡∏ö‡∏≤‡∏ó</span>
                        </div>
                    `;
                }
            }
            
            if (debtChangeDetailEl) {
                if (debtChange === 0) {
                    debtChangeDetailEl.innerHTML = '<div class="text-gray-600">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á</div>';
                } else {
                    debtChangeDetailEl.innerHTML = `
                        <div class="flex justify-between mb-1">
                            <span>‡πÄ‡∏î‡∏¥‡∏°:</span>
                            <span>${formatNumber(userData.debtPayment)} ‡∏ö‡∏≤‡∏ó</span>
                        </div>
                        <div class="flex justify-between mb-1">
                            <span>‡πÉ‡∏´‡∏°‡πà:</span>
                            <span>${formatNumber(newDebtPayment)} ‡∏ö‡∏≤‡∏ó</span>
                        </div>
                        <div class="flex justify-between font-bold ${debtChange <= 0 ? 'text-green-700' : 'text-red-700'}">
                            <span>‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á:</span>
                            <span>${debtChange >= 0 ? '+' : ''}${formatNumber(debtChange)} ‡∏ö‡∏≤‡∏ó</span>
                        </div>
                    `;
                }
            }
            
            if (expenseChangeDetailEl) {
                if (expenseChange === 0) {
                    expenseChangeDetailEl.innerHTML = '<div class="text-gray-600">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á</div>';
                } else {
                    expenseChangeDetailEl.innerHTML = `
                        <div class="flex justify-between mb-1">
                            <span>‡πÄ‡∏î‡∏¥‡∏°:</span>
                            <span>${formatNumber(originalTotalExpenses)} ‡∏ö‡∏≤‡∏ó</span>
                        </div>
                        <div class="flex justify-between mb-1">
                            <span>‡πÉ‡∏´‡∏°‡πà:</span>
                            <span>${formatNumber(newTotalExpenses)} ‡∏ö‡∏≤‡∏ó</span>
                        </div>
                        <div class="flex justify-between font-bold ${expenseChange <= 0 ? 'text-green-700' : 'text-red-700'}">
                            <span>‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á:</span>
                            <span>${expenseChange >= 0 ? '+' : ''}${formatNumber(expenseChange)} ‡∏ö‡∏≤‡∏ó</span>
                        </div>
                    `;
                }
            }
            
            // Generate smart recommendations
            generateAdjustmentRecommendations(newLiquidity, newDTI, newEmergencyMonths, {
                incomeChange,
                debtChange,
                expenseChange,
                liquidityChange
            });
        }
        
        function generateAdjustmentRecommendations(newLiquidity, newDTI, newEmergencyMonths, changes) {
            const recommendationEl = document.getElementById('recommendation-content');
            if (!recommendationEl) return;
            
            let recommendations = [];
            
            // Liquidity recommendations
            if (newLiquidity < 0) {
                if (changes.incomeChange > 0) {
                    recommendations.push('üí° ‡πÅ‡∏°‡πâ‡∏à‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà‡∏¢‡∏±‡∏á‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡∏≠‡∏¢‡∏π‡πà ‡∏Ñ‡∏ß‡∏£‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏´‡∏ô‡∏µ‡πâ');
                } else {
                    recommendations.push('üö® ‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏¢‡∏±‡∏á‡∏ï‡∏¥‡∏î‡∏•‡∏ö ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢/‡∏´‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°');
                }
            } else if (newLiquidity > 0 && changes.liquidityChange > 0) {
                recommendations.push('üéâ ‡∏î‡∏µ‡∏°‡∏≤‡∏Å! ‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ô‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡∏≠‡∏≠‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡πÑ‡∏î‡πâ');
            }
            
            // DTI recommendations
            if (newDTI > 45) {
                recommendations.push('‚ö†Ô∏è ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡∏Ñ‡∏ß‡∏£‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏´‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°');
            } else if (newDTI <= 35 && changes.debtChange < 0) {
                recommendations.push('‚úÖ ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏î‡∏µ ‡∏Å‡∏≤‡∏£‡∏•‡∏î‡∏´‡∏ô‡∏µ‡πâ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏°‡∏µ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô');
            }
            
            // Emergency fund recommendations
            if (newEmergencyMonths < 3) {
                recommendations.push('üí∞ ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠ ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏£‡πà‡∏á‡∏≠‡∏≠‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡πâ‡∏ñ‡∏∂‡∏á 3-6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô');
            } else if (newEmergencyMonths > 6) {
                recommendations.push('üìà ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏õ‡πâ‡∏≤ ‡∏Ñ‡∏ß‡∏£‡∏ô‡∏≥‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï');
            }
            
            // Income change recommendations
            if (changes.incomeChange > 0) {
                recommendations.push('üíπ ‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡∏Ñ‡∏ß‡∏£‡∏°‡∏≠‡∏á‡∏´‡∏≤‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏™‡∏£‡∏¥‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°');
            }
            
            // Expense change recommendations
            if (changes.expenseChange < 0) {
                recommendations.push('üõí ‡∏Å‡∏≤‡∏£‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ä‡πà‡∏ß‡∏¢‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ ‡∏Ñ‡∏ß‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ');
            }
            
            // Overall recommendations
            if (changes.liquidityChange > 5000) {
                recommendations.push('üéØ ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡∏ô‡∏µ‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏°‡∏≤‡∏Å ‡∏Ñ‡∏ß‡∏£‡∏ô‡∏≥‡πÑ‡∏õ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏à‡∏£‡∏¥‡∏á');
            } else if (changes.liquidityChange < -1000) {
                recommendations.push('üîÑ ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏¢‡πà‡∏•‡∏á ‡∏Ñ‡∏ß‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÉ‡∏´‡∏°‡πà');
            }
            
            if (recommendations.length === 0) {
                recommendations.push('üìä ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏≤‡∏Å ‡∏•‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°');
            }
            
            recommendationEl.innerHTML = recommendations.map(rec => `<div class="mb-2">‚Ä¢ ${rec}</div>`).join('');
        }

        function restart() {
            currentStep = 0;
            selectedOrganization = '';
            userData = {
                income: 0,
                debtPayment: 0,
                expenses: {
                    food: 0,
                    transport: 0,
                    household: 0,
                    utilities: 0,
                    entertainment: 0,
                    clothing: 0,
                    communication: 0,
                    other: 0
                },
                savings: 0
            };
            
            // Reset organization selection
            clearOrgSelection();
            switchOrgType('branch'); // Default to branch
            
            document.getElementById('results-screen').classList.add('hidden');
            document.getElementById('emergency-simulator').classList.add('hidden');
            document.getElementById('welcome-screen').classList.remove('hidden');
            updateProgress();
        }

        // Element SDK Integration
        async function onConfigChange(config) {
            const mainTitle = document.getElementById('main-title');
            const subtitle = document.getElementById('subtitle');
            const startBtn = document.getElementById('start-btn');
            
            if (mainTitle) {
                mainTitle.textContent = config.main_title || defaultConfig.main_title;
            }
            if (subtitle) {
                subtitle.textContent = config.subtitle || defaultConfig.subtitle;
            }
            if (startBtn) {
                startBtn.textContent = config.start_button_text || defaultConfig.start_button_text;
            }
        }

        function mapToCapabilities(config) {
            return {
                recolorables: [],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            };
        }

        function mapToEditPanelValues(config) {
            return new Map([
                ["main_title", config.main_title || defaultConfig.main_title],
                ["subtitle", config.subtitle || defaultConfig.subtitle],
                ["start_button_text", config.start_button_text || defaultConfig.start_button_text]
            ]);
        }

        // Initialize Element SDK
        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig,
                onConfigChange,
                mapToCapabilities,
                mapToEditPanelValues
            });
        }

        // Initialize app when DOM is ready
        document.addEventListener('DOMContentLoaded', init);
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99e383cb633cf305',t:'MTc2MzA5MTkxMy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
