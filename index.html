<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô ‚Ä¢ Simple & Personal</title>
<meta name="color-scheme" content="light only">
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
<style>
:root{
  --from:#0f0c29; --mid:#302b63; --to:#24243e;
  --primary:#6366f1; --secondary:#8b5cf6; --ring:#e5e7eb;
}
html,body{height:100%}
body{
  margin:0; font-family:'Inter','Noto Sans Thai',system-ui,-apple-system,'Segoe UI',sans-serif;
  background:linear-gradient(135deg,var(--from) 0%,var(--mid) 50%,var(--to) 100%);
}
.glass{ background:rgba(255,255,255,.94); backdrop-filter:blur(16px); border:1px solid rgba(255,255,255,.35) }
.btn{ transition:transform .2s ease, box-shadow .2s ease }
.btn:hover{ transform:translateY(-1px); box-shadow:0 10px 24px rgba(99,102,241,.35) }
.mono{ font-variant-numeric:tabular-nums }
.ring-anim{ transition:stroke-dashoffset .9s cubic-bezier(.2,.8,.2,1) }
input[data-money]{ text-align:right }
.sr{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0 }
.text-balance{ text-wrap:balance }
.break-any{ overflow-wrap:break-word; word-break:break-word }
</style>
</head>
<body class="min-h-full">
  <main class="relative z-10 min-h-full flex items-center justify-center p-4">
    <div class="w-full max-w-3xl">
      <!-- Progress -->
      <div id="progressContainer" class="mb-6 hidden" aria-live="polite">
        <div class="flex justify-between items-center mb-2">
          <span class="text-white/85 text-sm font-medium">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</span>
          <span id="progressText" class="text-white text-sm font-bold">0%</span>
        </div>
        <div class="bg-white/15 rounded-full h-2 overflow-hidden backdrop-blur">
          <div id="progressBar" class="h-2 rounded-full" style="width:0%;background:linear-gradient(90deg,var(--primary),var(--secondary))"></div>
        </div>
      </div>

      <div class="glass rounded-3xl shadow-2xl p-6 sm:p-8">
        <!-- Welcome -->
        <section id="welcomeScreen">
          <div class="text-center">
            <div class="inline-block p-6 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-3xl mb-6 shadow-2xl" aria-hidden="true">
              <div class="text-6xl">üí∞</div>
            </div>
            <h1 class="text-3xl sm:text-5xl font-extrabold mb-3 text-balance break-any" style="background:linear-gradient(135deg,var(--primary),var(--secondary));-webkit-background-clip:text;-webkit-text-fill-color:transparent">
              ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô
            </h1>
            <p class="text-gray-600 mb-4 sm:mb-6 text-base sm:text-lg font-medium max-w-xl mx-auto text-balance break-any">
              ‡∏Å‡∏£‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏à‡∏£‡∏¥‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏±‡∏ö‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏±‡πâ‡∏ô ‡∏ä‡∏±‡∏î ‡πÅ‡∏•‡∏∞‡πÅ‡∏ú‡∏ô‡∏õ‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á
            </p>
            <button id="btnStart" class="btn w-full px-6 py-4 sm:py-5 rounded-2xl text-white font-bold text-base sm:text-lg shadow-xl"
              style="background:linear-gradient(135deg,var(--primary),var(--secondary))">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‚Üí</button>
          </div>
        </section>

        <!-- Questions -->
        <section id="questionScreen" class="hidden" aria-live="polite">
          <div id="questionContent"></div>
        </section>

        <!-- Attitude -->
        <section id="attitudeScreen" class="hidden" aria-live="polite">
          <div id="attitudeContent"></div>
        </section>

        <!-- Final -->
        <section id="finalScreen" class="hidden">
          <div id="finalContent"></div>
        </section>
      </div>
    </div>
  </main>

  <div id="toastRoot" class="fixed left-1/2 -translate-x-1/2 bottom-6 z-[9999]" aria-live="assertive" aria-atomic="true"></div>

<script>
/* ===== helpers (‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ || ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏±‡∏ô parsing error) ===== */
function def(v,d){ return (v===undefined||v===null)?d:v; }
const moneyFmt = new Intl.NumberFormat('th-TH',{maximumFractionDigits:0});
function thb(n){ const x=Number(n); return moneyFmt.format(Math.round(Number.isFinite(x)?x:0)); }
function $(id){ return document.getElementById(id); }
function toast(msg){
  const root=$('toastRoot'); const el=document.createElement('div');
  el.className='px-4 py-3 rounded-xl text-white shadow-lg mb-2'; el.style.background='#6366f1'; el.textContent=String(msg);
  root.appendChild(el); setTimeout(()=>{ el.style.opacity=.0; },1500); setTimeout(()=>el.remove(),2100);
}
function parseMoneyInput(el){
  if(!el) return 0;
  const raw=String(def(el.dataset.raw, el.value)).replace(/,/g,'').trim();
  const n=Number(raw); return Number.isFinite(n)&&n>=0?n:0;
}
document.addEventListener('input',(e)=>{
  const t=e.target;
  if(t.matches('input[data-money]')){
    const cleaned=(t.value||'').replace(/[^\d.]/g,'').replace(/(\..*?)\..*/,'$1');
    t.dataset.raw=cleaned;
    if(cleaned===''){ t.value=''; return; }
    const parts=cleaned.split('.');
    parts[0]=parts[0].replace(/\B(?=(\d{3})+(?!\d))/g,',');
    t.value=parts.join('.');
  }
});

/* ===== data ===== */
let step=0, attStep=0;
const expenseCategories=[
  {key:'food',label:'‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£',icon:'üçú',need:true},
  {key:'transport',label:'‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á/‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô',icon:'üöó',need:true},
  {key:'utilities',label:'‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥/‡πÑ‡∏ü',icon:'üí°',need:true},
  {key:'clothing',label:'‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏î‡∏±‡∏ö',icon:'üëî',need:false}
];
let user={income:0,debt:0,expenses:{},savings:0,attitudeAnswers:[],results:null};

const questions=[
  {id:'income',title:'‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',icon:'üíµ',desc:'‡πÉ‡∏™‡πà‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',type:'single',field:'income'},
  {id:'debt',title:'‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏´‡∏ô‡∏µ‡πâ‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',icon:'üí≥',desc:'‡∏¢‡∏≠‡∏î‡∏ú‡πà‡∏≠‡∏ô/‡∏ä‡∏≥‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ‡∏£‡∏ß‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',type:'single',field:'debt'},
  {id:'expenses',title:'‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥ (‡πÅ‡∏¢‡∏Å‡∏´‡∏°‡∏ß‡∏î)',icon:'üõí',desc:'‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏°‡∏ß‡∏î/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',type:'multiple'}
];

const attitudeQuestions = [
  { id:'saveFirst', q:'‡πÑ‡∏î‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏£‡∏Å?', opts:[
      {t:'‡∏≠‡∏≠‡∏°‡∏Å‡πà‡∏≠‡∏ô (Pay Yourself First)', ok:true},{t:'‡∏à‡πà‡∏≤‡∏¢‡∏´‡∏ô‡∏µ‡πâ‡∏Å‡πà‡∏≠‡∏ô', ok:false},{t:'‡πÉ‡∏ä‡πâ‡∏Å‡πà‡∏≠‡∏ô ‡∏Ñ‡πà‡∏≠‡∏¢‡∏≠‡∏≠‡∏°', ok:false}
    ], tipOK:'‡∏î‡∏µ‡∏°‡∏≤‡∏Å! ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏ô‡∏¥‡∏™‡∏±‡∏¢‡∏≠‡∏≠‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏∞', tipNG:'‡∏ï‡∏±‡πâ‡∏á‡πÇ‡∏≠‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ß‡∏±‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å 10‚Äì20% ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ ‚Äú‡∏≠‡∏≠‡∏°‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏à‡∏£‡∏¥‡∏á‚Äù' },
  { id:'longPlan', q:'‡∏°‡∏µ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß‡πÑ‡∏´‡∏°?', opts:[
      {t:'‡∏°‡∏µ‡πÅ‡∏•‡∏∞‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠', ok:true},{t:'‡∏°‡∏µ‡∏Ñ‡∏£‡πà‡∏≤‡∏ß‡πÜ', ok:false},{t:'‡πÑ‡∏°‡πà‡∏°‡∏µ', ok:false}
    ], tipOK:'‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î! ‡πÅ‡∏ú‡∏ô + ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° = ‡∏ñ‡∏∂‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏£‡πá‡∏ß', tipNG:'‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ 1‚Äì3 ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á (‡πÄ‡∏ä‡πà‡∏ô ‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô 6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô) ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏ó‡∏∏‡∏Å‡∏™‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô' },
  { id:'bonusUse', q:'‡πÑ‡∏î‡πâ‡πÇ‡∏ö‡∏ô‡∏±‡∏™/‡πÄ‡∏á‡∏¥‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏© ‡πÉ‡∏ä‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£?', opts:[
      {t:'‡∏≠‡∏≠‡∏°/‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å', ok:true},{t:'‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡πÑ‡∏î‡πâ', ok:false},{t:'‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏≠‡∏≠‡∏° ‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÉ‡∏ä‡πâ', ok:false}
    ], tipOK:'‡∏î‡∏µ‡∏°‡∏≤‡∏Å! ‡πÄ‡∏á‡∏¥‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ä‡πà‡∏ß‡∏¢‡∏î‡∏±‡∏ô‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÑ‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô', tipNG:'‡∏Å‡∏±‡∏ô 70‚Äì80% ‡πÄ‡∏Ç‡πâ‡∏≤‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô/‡∏•‡∏á‡∏ó‡∏∏‡∏ô ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢' },
  { id:'tracking', q:'‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏Ñ‡πà‡πÑ‡∏´‡∏ô?', opts:[
      {t:'‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå', ok:true},{t:'‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ö‡πâ‡∏≤‡∏á', ok:false},{t:'‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', ok:false}
    ], tipOK:'‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°! ‚Äú‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏õ‡πÑ‡∏´‡∏ô‚Äù ‡∏Ñ‡∏∑‡∏≠‡∏û‡∏•‡∏±‡∏á', tipNG:'‡∏à‡∏î‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡∏ß‡∏±‡∏ô‡∏•‡∏∞ 1 ‡∏ô‡∏≤‡∏ó‡∏µ ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡πÅ‡∏≠‡∏õ/‡∏ä‡∏µ‡∏ï ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏•‡∏∞‡∏Ñ‡∏£‡∏±‡πâ‡∏á' },
  { id:'sale', q:'‡πÄ‡∏à‡∏≠‡πÇ‡∏õ‡∏£‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤ ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£?', opts:[
      {t:'‡∏î‡∏π‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡πà‡∏≠‡∏ô', ok:true},{t:'‡∏£‡∏µ‡∏ö‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏Ñ‡∏∏‡πâ‡∏°', ok:false},{t:'‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô', ok:false}
    ], tipOK:'‡∏î‡∏µ‡∏°‡∏≤‡∏Å! ‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏£‡∏≤‡∏∞ ‚Äú‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á‚Äù', tipNG:'‡∏ñ‡∏≤‡∏° 2 ‡∏Ç‡πâ‡∏≠: ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏´‡∏°? ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏•‡∏î ‡∏à‡∏∞‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏´‡∏°?' }
];

/* ===== progress ===== */
function setProgress(i,total){
  const p=Math.max(0,Math.min(100,Math.round(i/total*100)));
  $('progressBar').style.width=p+'%'; $('progressText').textContent=p+'%';
}

/* ===== flow: start & questions ===== */
function start(){
  $('welcomeScreen').classList.add('hidden');
  $('progressContainer').classList.remove('hidden');
  $('questionScreen').classList.remove('hidden');
  step=0; renderQuestion();
}
function moneyInput(id){
  return `<input id="${id}" data-money class="w-full px-4 py-3 border rounded-xl text-right mono" inputmode="decimal" placeholder="0">`;
}
function renderQuestion(){
  const total = questions.length + attitudeQuestions.length;
  const q=questions[step]; setProgress(step+1,total);

  if(q.type==='single'){
    $('questionContent').innerHTML=`
      <div class="text-center mb-5">
        <div class="inline-block p-5 bg-gradient-to-br from-purple-100 to-indigo-100 rounded-2xl mb-3"><div class="text-5xl">${q.icon}</div></div>
        <h2 class="text-2xl sm:text-3xl font-bold mb-1 text-gray-800 text-balance break-any">${q.title}</h2>
        <p class="text-gray-600 text-sm sm:text-base">${q.desc}</p>
      </div>
      <div class="mb-5">${moneyInput('money_single')}</div>
      <div class="flex gap-3">
        ${step>0?'<button id="btnPrev" class="px-5 py-3 rounded-xl bg-gray-100 font-semibold">‚Üê ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>':''}
        <button id="btnNext" class="btn flex-1 px-6 py-3 rounded-xl text-white font-bold" style="background:linear-gradient(135deg,var(--primary),var(--secondary))">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí</button>
      </div>`;
    const el=$('money_single'); const init=Number(def(user[q.field],0)); if(init>0){ el.value=thb(init); el.dataset.raw=String(init); }
    $('btnPrev')&&$('btnPrev').addEventListener('click',()=>{ step--; renderQuestion(); });
    $('btnNext').addEventListener('click',()=>{
      const v=parseMoneyInput($('money_single'));
      if(!(v>=0)){ toast('‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'); return; }
      user[q.field]=v; step++; if(step<questions.length){ renderQuestion(); } else { compute(); }
    });
  }else{
    const rows=expenseCategories.map(c=>`
      <div>
        <label class="block text-sm font-bold mb-1 text-gray-700"><span class="text-2xl mr-1">${c.icon}</span>${c.label}${c.need?'<span class="ml-2 text-[10px] px-2 py-[2px] rounded-full bg-emerald-50 text-emerald-600 border border-emerald-200">‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô</span>':''}</label>
        ${moneyInput('ex_'+c.key)}
      </div>`).join('');
    $('questionContent').innerHTML=`
      <div class="text-center mb-4">
        <div class="inline-block p-5 bg-gradient-to-br from-purple-100 to-indigo-100 rounded-2xl mb-3"><div class="text-5xl">${q.icon}</div></div>
        <h2 class="text-2xl sm:text-3xl font-bold mb-1 text-gray-800 text-balance break-any">${q.title}</h2>
        <p class="text-gray-600 text-sm sm:text-base">${q.desc}</p>
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-5">${rows}</div>
      <div class="flex gap-3">
        <button id="btnPrev" class="px-5 py-3 rounded-xl bg-gray-100 font-semibold">‚Üê ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
        <button id="btnNext" class="btn flex-1 px-6 py-3 rounded-xl text-white font-bold" style="background:linear-gradient(135deg,var(--primary),var(--secondary))">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí</button>
      </div>`;
    expenseCategories.forEach(c=>{
      const v=Number(def(user.expenses[c.key],0));
      if(v>0){ const el=$('ex_'+c.key); el.value=thb(v); el.dataset.raw=String(v); }
    });
    $('btnPrev').addEventListener('click',()=>{ step--; renderQuestion(); });
    $('btnNext').addEventListener('click',()=>{
      expenseCategories.forEach(c=>{ user.expenses[c.key]=parseMoneyInput($('ex_'+c.key)); });
      step++; compute();
    });
  }
}

/* ===== core compute ===== */
function safeDiv(a,b){ return b>0?(a/b):0; }
function compute(){
  const inc=Number(def(user.income,0));
  const debt=Number(def(user.debt,0));
  const spend=expenseCategories.reduce((s,c)=> s + Number(def(user.expenses[c.key],0)),0);
  const totalExp=debt+spend;
  const dti=safeDiv(debt,inc)*100;
  const liquidity=inc-totalExp;

  user.results={inc,debt,spend,totalExp,dti,liquidity,offenders:expenseCategories.map(c=>({
    key:c.key,label:c.label,need:c.need,v:Number(def(user.expenses[c.key],0))
  })).filter(x=>x.v>0).sort((a,b)=>b.v-a.v)};

  // ‡πÑ‡∏õ‡∏™‡πà‡∏ß‡∏ô‡∏ß‡∏±‡∏î‡∏ó‡∏±‡∏®‡∏ô‡∏Ñ‡∏ï‡∏¥
  $('questionScreen').classList.add('hidden');
  $('attitudeScreen').classList.remove('hidden');
  attStep=0; user.attitudeAnswers=[];
  renderAttitude();
}

/* ===== attitude ===== */
function renderAttitude(){
  const total=questions.length + attitudeQuestions.length;
  const q=attitudeQuestions[attStep]; setProgress(questions.length + attStep + 1, total);
  const opts=q.opts.map((o,i)=>`
    <button class="btn w-full text-left px-5 py-4 bg-gradient-to-r from-gray-50 to-gray-100 rounded-2xl border-2 border-gray-200 hover:border-indigo-400 font-semibold text-gray-800"
      data-ans="${i}">
      <span class="flex items-center gap-3"><span class="text-xl">‚Ä¢</span><span class="break-any">${o.t}</span></span>
    </button>`).join('');
  $('attitudeContent').innerHTML=`
    <div class="text-center mb-5">
      <div class="inline-block p-5 bg-gradient-to-br from-yellow-100 to-orange-100 rounded-2xl mb-3" aria-hidden="true"><div class="text-5xl">ü§î</div></div>
      <div class="inline-block px-3 py-1 bg-purple-100 rounded-full mb-3 text-purple-700 text-xs sm:text-sm font-bold">
        ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà ${attStep+1}/${attitudeQuestions.length}
      </div>
      <p class="text-lg sm:text-xl text-gray-800 font-bold leading-relaxed max-w-xl mx-auto text-balance break-any">${q.q}</p>
    </div>
    <div class="grid gap-3">${opts}</div>`;
  $('attitudeContent').querySelectorAll('[data-ans]').forEach(b=>{
    b.addEventListener('click',()=>{
      const sel=q.opts[Number(b.dataset.ans)];
      user.attitudeAnswers.push({ id:q.id, q:q.q, a:sel.t, ok:sel.ok, tip: sel.ok ? q.tipOK : q.tipNG });
      attStep++;
      if(attStep<attitudeQuestions.length){ renderAttitude(); } else { renderFinal(); }
    });
  });
}

/* ===== final + editor + simulator ===== */
function ring(el,pct,color,label,valTxt){
  const R=54,C=2*Math.PI*R,p=Math.max(0,Math.min(100,pct));
  el.innerHTML=`
    <div class="p-4 rounded-2xl bg-white/90 border border-white/60 shadow text-center">
      <svg width="140" height="140" viewBox="0 0 140 140" class="mx-auto block" role="img" aria-label="${label} ${valTxt}">
        <circle cx="70" cy="70" r="${R}" stroke="var(--ring)" stroke-width="14" fill="none"></circle>
        <circle cx="70" cy="70" r="${R}" stroke="${color}" stroke-linecap="round" stroke-width="14" fill="none"
          class="ring-anim" style="stroke-dasharray:${C};stroke-dashoffset:${C};transform:rotate(-90deg);transform-origin:50% 50%"></circle>
        <text x="50%" y="50%" text-anchor="middle" dy="8" font-size="22" font-weight="800" fill="${color}">${valTxt}</text>
      </svg>
      <div class="mt-2 font-bold text-gray-800">${label}</div>
    </div>`;
  requestAnimationFrame(()=>{ el.querySelectorAll('circle')[1].style.strokeDashoffset=C*(1-p/100); });
}
function editableTable(initCaps,data){
  const rows = expenseCategories
    .filter(c=> Number(def(data.expenses[c.key],0))>0 || Number(def(initCaps[c.key],0))>0 )
    .map(c=>{
      const now = Number(def(data.expenses[c.key],0));
      const rec = Number(def(initCaps[c.key], now));
      return `<tr class="text-sm">
        <td class="py-2">${c.icon} ${c.label}${c.need?'<span class="text-[10px] ml-2 px-2 py-[2px] rounded-full bg-emerald-50 text-emerald-600 border border-emerald-200">‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô</span>':''}</td>
        <td class="py-2 text-right mono">${thb(now)}</td>
        <td class="py-2 text-right"><input data-money data-cap="${c.key}" class="w-28 px-2 py-1 rounded-lg border text-right" value="${thb(rec)}" aria-label="‡∏õ‡∏£‡∏±‡∏ö ${c.label}"></td>
        <td class="py-2 text-right mono" id="diff_${c.key}"></td>
      </tr>`;
    }).join('');
  return `<table class="w-full">
    <thead><tr class="text-xs text-gray-500 border-b">
      <th class="py-2 text-left">‡∏´‡∏°‡∏ß‡∏î</th><th class="py-2 text-right">‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</th>
      <th class="py-2 text-right">‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡∏°‡πà (‡πÉ‡∏™‡πà‡πÄ‡∏≠‡∏á)</th><th class="py-2 text-right">‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á</th>
    </tr></thead><tbody>${rows}</tbody></table>
    <p class="text-xs text-gray-500 mt-2">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ ‡∏•‡∏î 10‚Äì20% ‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡πà‡∏≠‡∏ô</p>
    <div id="planSummary" class="mt-3 text-sm p-3 rounded-xl border bg-white" aria-live="polite"></div>`;
}
function renderFinal(){
  $('attitudeScreen').classList.add('hidden');
  $('progressContainer').classList.add('hidden');
  $('finalScreen').classList.remove('hidden');

  const R=user.results;

  /* ‡πÄ‡∏û‡∏î‡∏≤‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô: ‡∏•‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 20% ‡∏Ç‡∏≠‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏° */
  const initCaps={};
  expenseCategories.forEach(c=>{
    const now=Number(def(user.expenses[c.key],0));
    initCaps[c.key]= now>0 ? Math.round(now*0.8) : 0;
  });

  // ‡∏£‡∏ß‡∏°‡∏ó‡∏¥‡∏õ‡∏ó‡∏±‡∏®‡∏ô‡∏Ñ‡∏ï‡∏¥‡πÅ‡∏ö‡∏ö‡∏¢‡πà‡∏≠ (‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢)
  const attTips = user.attitudeAnswers.slice(0,5).map(v=>{
    return `<li class="${v.ok?'text-emerald-700':'text-amber-700'}"><span class="font-semibold">${v.a}</span> ‚Äî ${v.tip}</li>`;
  }).join('');

  $('finalContent').innerHTML=`
    <div class="text-center mb-2">
      <div class="inline-block p-5 bg-gradient-to-br from-green-100 to-emerald-100 rounded-2xl mb-3" aria-hidden="true"><div class="text-5xl">‚ú®</div></div>
      <h2 class="text-2xl sm:text-3xl font-extrabold text-balance break-any" style="background:linear-gradient(135deg,var(--primary),var(--secondary));-webkit-background-clip:text;-webkit-text-fill-color:transparent">
        ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ ‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á)
      </h2>
      <p class="text-gray-500 text-sm">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 my-3" id="ringRow"></div>

    <div class="bg-white rounded-2xl p-5 border">
      <div class="flex items-center gap-2 mb-2">
        <span class="text-2xl">üß≠</span><h3 class="text-lg font-bold text-balance break-any">‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏´‡∏°‡∏ß‡∏î (‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏≠‡∏á)</h3>
      </div>
      ${editableTable(initCaps,user)}
    </div>

    <div class="bg-white/90 border rounded-2xl p-5 shadow mt-4">
      <div class="flex items-center gap-2 mb-2"><span class="text-2xl">üß™</span><h3 class="text-lg font-bold">‡∏•‡∏≠‡∏á‡∏Ç‡∏¢‡∏±‡∏ö ‡πÅ‡∏•‡πâ‡∏ß‡∏î‡∏π‡∏ú‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</h3></div>
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
        <div>
          <label class="block text-sm font-semibold mb-1" for="simCut">‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ Top 3 (‡∏´‡∏°‡∏ß‡∏î‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)</label>
          <input id="simCut" type="range" min="0" max="40" step="1" value="15" class="w-full">
          <div class="text-xs text-gray-600">‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ: <span id="simCutVal" class="mono">15%</span></div>
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1" for="simDebtNew">‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î ‚Äú‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà‚Äù / ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‚â§ ${thb(R.debt)}‡∏ø)</label>
          <input id="simDebtNew" data-money class="w-full px-3 py-2 border rounded-xl mono" value="${thb(R.debt)}">
          <div class="text-xs text-gray-600 mt-1">‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏î‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á ‚â• 0: <span id="needReduce" class="mono">0</span> ‡∏ø</div>
        </div>
        <div>
          <label class="block text-sm font-semibold mb-1" for="simEF">‡∏≠‡∏≠‡∏°‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</label>
          <input id="simEF" type="range" min="0" max="30" step="1" value="10" class="w-full">
          <div class="text-xs text-gray-600">‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ: <span id="simEFVal" class="mono">10%</span> ‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ (<span id="simEFBaht" class="mono"></span>‡∏ø)</div>
        </div>
      </div>
      <div id="simResult" class="grid grid-cols-1 sm:grid-cols-3 gap-3 mt-4"></div>
      <div id="simAdvice" class="text-sm text-gray-700 leading-relaxed mt-3 break-any"></div>
    </div>

    <div class="bg-white rounded-2xl p-5 border mt-4">
      <h3 class="text-lg font-bold mb-2">‡∏ó‡∏±‡∏®‡∏ô‡∏Ñ‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô (‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏±‡πâ‡∏ô)</h3>
      <ul class="list-disc list-inside space-y-1 text-sm">${attTips}</ul>
    </div>
  `;

  // rings ‚Äî DTI ‡∏ï‡∏≤‡∏°‡∏à‡∏£‡∏¥‡∏á / EF ‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏à‡∏≤‡∏Å totalExp / LIQ ‡∏à‡∏≤‡∏Å inc-totalExp
  const row=$('ringRow'); const a=document.createElement('div'), b=document.createElement('div'), c=document.createElement('div'); row.append(a,b,c);
  const dtiPct=Math.min(100,R.dti);
  const efMonths = safeDiv(0, R.totalExp); // ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ô‡∏≥‡∏¢‡∏≠‡∏î‡∏≠‡∏≠‡∏°‡∏™‡∏∞‡∏™‡∏°‡∏°‡∏≤‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ô‡∏µ‡πâ ‚Üí 0 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
  const efPct = Math.min(100,(efMonths/6)*100);
  const liqPct = R.liquidity<=0?0:Math.min(100,(R.liquidity/Math.max(1,R.inc))*100);
  const dtiColor = R.dti<=35?'#10b981':(R.dti<=45?'#f59e0b':'#ef4444');
  ring(a,dtiPct,dtiColor,'DTI', R.dti.toFixed(1)+'%');
  ring(b,efPct,'#10b981','‡πÄ‡∏á‡∏¥‡∏ô‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô', efMonths.toFixed(1)+'‡∏î.');
  ring(c,liqPct, R.liquidity<0?'#ef4444':'#10b981','‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á/‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ', liqPct.toFixed(0)+'%');

  // editable plan
  function recalcPlan(){
    let newSpend=0;
    expenseCategories.forEach(c=>{
      const now=Number(def(user.expenses[c.key],0));
      const inp=document.querySelector('[data-cap="'+c.key+'"]');
      let t=now; if(inp){ t=parseMoneyInput(inp); }
      if(t>now) t=now; // ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°
      newSpend+=t;
      const diff=t-now; const diffEl=$('diff_'+c.key);
      if(diffEl){ diffEl.style.color= diff<=0 ? '#10b981' : '#ef4444'; diffEl.textContent=(diff<=0?'':'+')+thb(diff); }
    });
    const newTotal=newSpend + R.debt;
    const newLiq= R.inc - newTotal;
    $('planSummary').innerHTML = `
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-2">
        <div><div class="text-xs text-gray-500">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà (‡∏£‡∏ß‡∏°‡∏´‡∏°‡∏ß‡∏î)</div><div class="mono font-extrabold">${thb(newSpend)} ‡∏ø</div></div>
        <div><div class="text-xs text-gray-500">DTI (‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î)</div><div class="mono font-extrabold">${R.dti.toFixed(1)}%</div></div>
        <div><div class="text-xs text-gray-500">‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå</div><div class="mono font-extrabold" style="color:${newLiq<0?'#ef4444':'#10b981'}">${thb(newLiq)} ‡∏ø</div></div>
      </div>
      <div class="mt-2 ${newLiq<0?'text-rose-700':'text-emerald-700'} text-sm">
        ${newLiq<0? '‡∏¢‡∏±‡∏á‡∏ï‡∏¥‡∏î‡∏•‡∏ö ‚Üí ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤ ‚Äú‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î‡∏´‡∏ô‡∏µ‡πâ/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‚Äù (‡πÄ‡∏à‡∏£‡∏à‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á/‡∏£‡∏µ‡πÑ‡∏ü‡πÅ‡∏ô‡∏ô‡∏ã‡πå) ‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏£‡∏±‡∏ö‡∏´‡∏°‡∏ß‡∏î‡∏≠‡∏∑‡πà‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°' : '‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‚Üí ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏±‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô‡πÑ‡∏î‡πâ'}
      </div>`;
  }
  document.querySelectorAll('[data-cap]').forEach(el=> el.addEventListener('input', recalcPlan));
  recalcPlan();

  // simulator
  const simCut=$('simCut'), simDebtNew=$('simDebtNew'), simEF=$('simEF');
  const simCutVal=$('simCutVal'), simEFVal=$('simEFVal'), simEFBaht=$('simEFBaht'), needReduce=$('needReduce');

  function syncLabels(){
    simCutVal.textContent=simCut.value+'%';
    simEFVal.textContent=simEF.value+'%';
    simEFBaht.textContent=thb(R.inc*(Number(simEF.value)/100));
  }
  function clampDebtTarget(){
    const t=parseMoneyInput(simDebtNew);
    const max=R.debt; const clamped = t>max?max:(t<0?0:t);
    simDebtNew.dataset.raw=String(clamped); simDebtNew.value=thb(clamped);
    return clamped;
  }
  function runSim(){
    const cutPct=Number(simCut.value)/100;
    const debtTarget=clampDebtTarget();
    const reduceDebt=R.debt - debtTarget;

    let spendNew=R.spend;
    const top3 = user.results.offenders.filter(x=>!x.need).slice(0,3);
    for(let i=0;i<top3.length;i++){ spendNew -= top3[i].v*cutPct; }
    if(spendNew<0) spendNew=0;

    const debtNew=R.debt - reduceDebt;
    const totalNew=spendNew + debtNew;

    const minReduceToZero = Math.max(0, (R.spend + R.debt) - R.inc); // ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡∏•‡∏ö (‡∏Å‡πà‡∏≠‡∏ô‡∏Å‡∏±‡∏ô‡∏≠‡∏≠‡∏°)
    needReduce.textContent = thb(minReduceToZero);

    const dtiNew=safeDiv(debtNew,R.inc)*100;
    const saveEF = R.inc*(Number(simEF.value)/100);
    const needTo6m=Math.max(0, 6*totalNew - 0);
    const efMonthly=Math.min(saveEF,needTo6m);
    const liqNew=R.inc - totalNew - efMonthly;
    const efMonthsNew=safeDiv(efMonthly,totalNew);

    function card(label,val,sub,color){ return `
      <div class="rounded-xl border p-4 text-center" style="border-color:${color}">
        <div class="text-xs text-gray-500 mb-1">${label}</div>
        <div class="text-2xl font-extrabold mono" style="color:${color}">${val}</div>
        <div class="text-xs text-gray-500 mt-1">${sub}</div>
      </div>`; }
    $('simResult').innerHTML = [
      card('DTI ‡πÉ‡∏´‡∏°‡πà', Number.isFinite(dtiNew)?dtiNew.toFixed(1)+'%':'‚Äì', `‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á: ${Number.isFinite(dtiNew)?(R.dti-dtiNew).toFixed(1):'‚Äì'} ‡∏à‡∏∏‡∏î`, '#6366f1'),
      card('‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô (‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)', Number.isFinite(efMonthsNew)?efMonthsNew.toFixed(1)+' ‡∏î.':'‚Äì', `‡∏≠‡∏≠‡∏°/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: ${thb(efMonthly)}‡∏ø`, '#10b981'),
      card('‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏™‡∏∏‡∏ó‡∏ò‡∏¥', `${thb(liqNew)}‡∏ø`, `‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏±‡∏ô‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô ${thb(efMonthly)}‡∏ø`, liqNew>=0?'#10b981':'#ef4444')
    ].join('');

    $('simAdvice').innerHTML = `
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 mt-1">
        <div class="bg-white rounded-lg p-3 border">
          <div class="font-semibold mb-1">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ DTI 35%</div>
          ${dtiNew<=35 ? '<div class="text-sm text-green-700">‚úÖ ‡πÅ‡∏ï‡∏∞ ‚â§35% ‡πÅ‡∏•‡πâ‡∏ß</div>' :
            '<div class="text-sm">‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î‡∏≠‡∏µ‡∏Å <span class="mono font-bold">'+thb((debtNew - (R.inc*0.35)))+'</span> ‡∏ø/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>'}
        </div>
        <div class="bg-white rounded-lg p-3 border">
          <div class="font-semibold mb-1">‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á ‚â• 0</div>
          ${ R.inc - (spendNew+debtNew) >= 0 ? '<div class="text-sm text-green-700">‚úÖ ‡πÄ‡∏õ‡πá‡∏ô‡∏ö‡∏ß‡∏Å‡πÅ‡∏•‡πâ‡∏ß</div>' :
            '<div class="text-sm">‡∏ï‡πâ‡∏≠‡∏á ‚Äú‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î‚Äù ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ <span class="mono font-bold">'+thb((spendNew+debtNew)-R.inc)+'</span> ‡∏ø/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>'}
        </div>
        <div class="bg-white rounded-lg p-3 border">
          <div class="font-semibold mb-1">‡∏ú‡∏•‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</div>
          <div class="text-sm">‡∏ï‡∏±‡∏î Top3 (‡∏´‡∏°‡∏ß‡∏î‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô) ~<span class="mono">${Math.round(cutPct*100)}%</span>
          ‚Üí ‡∏•‡∏î‡∏£‡∏ß‡∏° ~<span class="mono">${thb(top3.reduce((s,x)=>s+x.v*cutPct,0))}</span> ‡∏ø/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
        </div>
      </div>`;
  }
  [simCut,simEF,simDebtNew].forEach(el=> el.addEventListener('input',()=>{ syncLabels(); runSim(); }));
  syncLabels(); runSim();
}

/* ===== init ===== */
document.addEventListener('DOMContentLoaded', ()=>{
  $('btnStart').addEventListener('click', start);
});
</script>
</body>
</html>
