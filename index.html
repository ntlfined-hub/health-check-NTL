<!doctype html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô ‚Ä¢ Simple & Personal</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{ --from:#0f0c29; --mid:#302b63; --to:#24243e; --primary:#6366f1; --secondary:#8b5cf6; --success:#10b981; --warn:#f59e0b; --danger:#ef4444 }
    html,body{height:100%}
    body{margin:0;padding:0;box-sizing:border-box;font-family:'Inter','Noto Sans Thai',system-ui,-apple-system,'Segoe UI',sans-serif;background:linear-gradient(135deg,var(--from) 0%,var(--mid) 50%,var(--to) 100%)}
    .glass{background:rgba(255,255,255,.94);backdrop-filter:blur(16px);border:1px solid rgba(255,255,255,.35)}
    .btn{position:relative;overflow:hidden;transition:transform .2s ease,box-shadow .2s ease}
    .btn:hover{transform:translateY(-1px);box-shadow:0 10px 24px rgba(99,102,241,.35)}
    .ring{transition:stroke-dashoffset .9s cubic-bezier(.2,.8,.2,1)}
    .chip{display:inline-block;padding:.2rem .5rem;border-radius:.5rem;background:#f1f5f9;font-weight:700}
    .mono{font-variant-numeric:tabular-nums}
    .grid-auto{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:.75rem}
    @view-transition{navigation:auto}
    input[type="text"].money{outline:none}
    td input{text-align:right}
  </style>
</head>
<body class="min-h-full">
  <!-- blobs -->
  <div class="pointer-events-none select-none">
    <div class="absolute top-20 left-10 w-72 h-72 bg-purple-500 rounded-full mix-blend-multiply blur-3xl opacity-20"></div>
    <div class="absolute top-40 right-10 w-72 h-72 bg-blue-500 rounded-full mix-blend-multiply blur-3xl opacity-20"></div>
    <div class="absolute -bottom-20 left-1/2 w-72 h-72 bg-indigo-500 rounded-full mix-blend-multiply blur-3xl opacity-20"></div>
  </div>

  <main class="relative z-10 min-h-full flex items-center justify-center p-4">
    <div class="w-full max-w-3xl">
      <!-- progress -->
      <div id="progressContainer" class="mb-6 hidden">
        <div class="flex justify-between items-center mb-2">
          <span class="text-white/80 text-sm font-medium">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</span>
          <span id="progressText" class="text-white text-sm font-bold">0%</span>
        </div>
        <div class="bg-white/15 rounded-full h-2 overflow-hidden backdrop-blur">
          <div id="progressBar" class="h-2 rounded-full" style="width:0%;background:linear-gradient(90deg,var(--primary),var(--secondary))"></div>
        </div>
      </div>

      <div class="glass rounded-3xl shadow-2xl p-6 sm:p-8">
        <!-- welcome -->
        <section id="welcomeScreen">
          <div class="text-center">
            <div class="inline-block p-6 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-3xl mb-6 shadow-2xl">
              <div class="text-6xl">üí∞</div>
            </div>
            <h1 class="text-4xl sm:text-5xl font-extrabold mb-3" style="-webkit-background-clip:text;-webkit-text-fill-color:transparent;background:linear-gradient(135deg,var(--primary),var(--secondary))">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</h1>
            <p class="text-gray-500 mb-8 sm:mb-10 text-base sm:text-lg font-medium max-w-md mx-auto">‡∏Å‡∏£‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏à‡∏£‡∏¥‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡∏ä‡∏±‡∏î‡πÜ ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</p>
            <div class="grid gap-3 sm:gap-4">
              <button id="btnStart" class="btn px-6 py-4 sm:px-10 sm:py-5 rounded-2xl text-white font-bold text-base sm:text-lg shadow-xl" style="background:linear-gradient(135deg,var(--primary),var(--secondary))">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ‚Üí</button>
              <button id="btnResume" class="btn px-6 py-4 rounded-2xl font-semibold text-gray-800 bg-white border border-gray-200 hidden">‚ñ∂Ô∏è ‡∏ï‡πà‡∏≠‡∏à‡∏≤‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Å‡πà‡∏≠‡∏ô</button>
            </div>
          </div>
        </section>

        <!-- questions -->
        <section id="questionScreen" class="hidden">
          <div id="questionContent"></div>
        </section>

        <!-- attitude -->
        <section id="attitudeScreen" class="hidden">
          <div id="attitudeContent"></div>
        </section>

        <!-- final -->
        <section id="finalScreen" class="hidden">
          <div id="finalContent"></div>
        </section>
      </div>
    </div>
  </main>

  <!-- toast -->
  <div id="toastRoot" class="fixed left-1/2 -translate-x-1/2 bottom-6 z-[9999]"></div>

  <script>
    /* ---------- helpers ---------- */
    const moneyFmt = new Intl.NumberFormat('th-TH',{maximumFractionDigits:0});
    const thb = n => moneyFmt.format(Math.round(n||0));
    const buzz = (ms=12)=> (navigator.vibrate && navigator.vibrate(ms));
    const $ = id => document.getElementById(id);
    function toast(msg,type='info'){
      const root=$('toastRoot'); const el=document.createElement('div');
      el.className='px-4 py-3 rounded-xl text-white shadow-lg mb-2';
      el.style.background= type==='success'?'#10b981': type==='warn'?'#f59e0b': type==='error'?'#ef4444':'#6366f1';
      el.textContent=msg; root.appendChild(el);
      setTimeout(()=>{el.style.opacity=.0; el.style.transform='translateY(6px)'},1600);
      setTimeout(()=>el.remove(),2200);
    }
    function parseMoneyInput(el){
      const raw = el.dataset.raw ?? el.value.replace(/,/g,'').trim();
      const n = parseFloat(raw); return isNaN(n)?0:n;
    }
    document.addEventListener('input',e=>{
      if(e.target.matches('input[data-money]')){
        const cleaned=e.target.value.replace(/[^\d.]/g,'').replace(/(\..*?)\..*/,'$1');
        e.target.dataset.raw=cleaned;
        if(cleaned===''){e.target.value='';return;}
        const parts=cleaned.split('.'); parts[0]=parts[0].replace(/\B(?=(\d{3})+(?!\d))/g,',');
        e.target.value=parts.join('.');
      }
    });

    /* ---------- data ---------- */
    let currentStep=0, currentAttitudeQuestion=0;
    let userData={ income:0, debtExpense:0, expenses:{}, savings:0, attitudeAnswers:[] };

    const expenseCategories=[
      {key:'food',label:'‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£',icon:'üçú',need:true},
      {key:'transport',label:'‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á/‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô',icon:'üöó',need:true},
      {key:'household',label:'‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏ö‡πâ‡∏≤‡∏ô',icon:'üè†',need:false},
      {key:'utilities',label:'‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥/‡πÑ‡∏ü',icon:'üí°',need:true},
      {key:'entertainment',label:'‡∏™‡∏±‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå/‡∏ö‡∏±‡∏ô‡πÄ‡∏ó‡∏¥‡∏á',icon:'üéâ',need:false},
      {key:'clothing',label:'‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤/‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏î‡∏±‡∏ö',icon:'üëî',need:false},
      {key:'internet',label:'‡πÄ‡∏ô‡πá‡∏ï/‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå',icon:'üì±',need:true},
      {key:'other',label:'‡∏≠‡∏∑‡πà‡∏ô‡πÜ',icon:'üìù',need:false}
    ];

    const attitudeQuestions = [
      { id:'saveFirst', q:'‡πÑ‡∏î‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏£‡∏Å?', opts:[
        {t:'‡∏≠‡∏≠‡∏°‡∏Å‡πà‡∏≠‡∏ô (Pay Yourself First)', ok:true},{t:'‡∏à‡πà‡∏≤‡∏¢‡∏´‡∏ô‡∏µ‡πâ‡∏Å‡πà‡∏≠‡∏ô', ok:false},{t:'‡πÉ‡∏ä‡πâ‡∏Å‡πà‡∏≠‡∏ô ‡∏Ñ‡πà‡∏≠‡∏¢‡∏≠‡∏≠‡∏°', ok:false}
      ], tipOK:'‡∏î‡∏µ‡∏°‡∏≤‡∏Å! ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏ô‡∏¥‡∏™‡∏±‡∏¢‡∏≠‡∏≠‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡∏ô‡∏∞', tipNG:'‡∏•‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡πÇ‡∏≠‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ß‡∏±‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å 10‚Äì20% ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ ‚Äú‡∏≠‡∏≠‡∏°‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏à‡∏£‡∏¥‡∏á‚Äù' },
      { id:'longPlan', q:'‡∏°‡∏µ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß‡πÑ‡∏´‡∏°?', opts:[
        {t:'‡∏°‡∏µ‡πÅ‡∏•‡∏∞‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠', ok:true},{t:'‡∏°‡∏µ‡∏Ñ‡∏£‡πà‡∏≤‡∏ß‡πÜ', ok:false},{t:'‡πÑ‡∏°‡πà‡∏°‡∏µ', ok:false}
      ], tipOK:'‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î! ‡πÅ‡∏ú‡∏ô + ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° = ‡∏ñ‡∏∂‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏£‡πá‡∏ß', tipNG:'‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ 1‚Äì3 ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á (‡πÄ‡∏ä‡πà‡∏ô ‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô 6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô) ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏ö‡∏ó‡∏ß‡∏ô‡∏ó‡∏∏‡∏Å‡∏™‡∏¥‡πâ‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô' },
      { id:'bonusUse', q:'‡πÑ‡∏î‡πâ‡πÇ‡∏ö‡∏ô‡∏±‡∏™/‡πÄ‡∏á‡∏¥‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏© ‡πÉ‡∏ä‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£?', opts:[
        {t:'‡∏≠‡∏≠‡∏°/‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å', ok:true},{t:'‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡πÑ‡∏î‡πâ', ok:false},{t:'‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏≠‡∏≠‡∏° ‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÉ‡∏ä‡πâ', ok:false}
      ], tipOK:'‡∏î‡∏µ‡∏°‡∏≤‡∏Å! ‡πÄ‡∏á‡∏¥‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ä‡πà‡∏ß‡∏¢‡∏î‡∏±‡∏ô‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÑ‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô', tipNG:'‡∏Å‡∏±‡∏ô 70‚Äì80% ‡πÄ‡∏Ç‡πâ‡∏≤‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô/‡∏•‡∏á‡∏ó‡∏∏‡∏ô ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡∏û‡∏≠' },
      { id:'tracking', q:'‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏Ñ‡πà‡πÑ‡∏´‡∏ô?', opts:[
        {t:'‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå', ok:true},{t:'‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ö‡πâ‡∏≤‡∏á', ok:false},{t:'‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å', ok:false}
      ], tipOK:'‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°! ‚Äú‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏õ‡πÑ‡∏´‡∏ô‚Äù ‡∏Ñ‡∏∑‡∏≠‡∏û‡∏•‡∏±‡∏á', tipNG:'‡∏à‡∏î‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡∏ß‡∏±‡∏ô‡∏•‡∏∞ 1 ‡∏ô‡∏≤‡∏ó‡∏µ ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡πÅ‡∏≠‡∏õ/‡∏ä‡∏µ‡∏ï ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏•‡∏∞‡∏Ñ‡∏£‡∏±‡πâ‡∏á' },
      { id:'sale', q:'‡πÄ‡∏à‡∏≠‡πÇ‡∏õ‡∏£‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤ ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£?', opts:[
        {t:'‡∏î‡∏π‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡πà‡∏≠‡∏ô', ok:true},{t:'‡∏£‡∏µ‡∏ö‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏Ñ‡∏∏‡πâ‡∏°', ok:false},{t:'‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô', ok:false}
      ], tipOK:'‡∏î‡∏µ‡∏°‡∏≤‡∏Å! ‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏£‡∏≤‡∏∞ ‚Äú‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á‚Äù', tipNG:'‡∏ñ‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á 2 ‡∏Ç‡πâ‡∏≠: ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏´‡∏°? ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏•‡∏î‡∏£‡∏≤‡∏Ñ‡∏≤ ‡∏à‡∏∞‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏´‡∏°?' }
    ];

    const questions=[
      {id:'income',title:'‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',icon:'üíµ',desc:'‡∏Å‡∏£‡∏≠‡∏Å ‚Äú‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°‚Äù ‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',type:'single',field:'income'},
      {id:'debt',title:'‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏´‡∏ô‡∏µ‡πâ‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',icon:'üí≥',desc:'‡∏Å‡∏£‡∏≠‡∏Å‡∏¢‡∏≠‡∏î‡∏ú‡πà‡∏≠‡∏ô/‡∏ä‡∏≥‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ‡∏£‡∏ß‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',type:'single',field:'debtExpense'},
      {id:'expenses',title:'‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡∏à‡∏≥ (‡πÅ‡∏¢‡∏Å‡∏´‡∏°‡∏ß‡∏î)',icon:'üõí',desc:'‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏°‡∏ß‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô',type:'multiple',field:'expenses'},
      {id:'savings',title:'‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô',icon:'üè¶',desc:'‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏°‡∏™‡∏∞‡∏™‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà',type:'single',field:'savings'}
    ];

    /* ---------- autosave ---------- */
    const SAVE_KEY='finhealth:simple:v1', qs=new URLSearchParams(location.search);
    function loadState(){ try{
      if(qs.get('s')){ userData=JSON.parse(decodeURIComponent(atob(qs.get('s')))); return true; }
      const raw=localStorage.getItem(SAVE_KEY); if(raw){ userData=JSON.parse(raw); return true; }
    }catch(e){} return false;}
    function saveState(){
      const minimal={ income:userData.income, debtExpense:userData.debtExpense, expenses:userData.expenses, savings:userData.savings, attitudeAnswers:userData.attitudeAnswers, results:userData.results||null, sim:userData.sim||null };
      localStorage.setItem(SAVE_KEY,JSON.stringify(minimal));
    }
    const debounce=(fn=>{let t;return()=>{clearTimeout(t);t=setTimeout(fn,300)}})(saveState);
    function shareResult(){
      if(!userData.results){ toast('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå','warn'); return; }
      const s=btoa(encodeURIComponent(JSON.stringify(userData)));
      const url=`${location.origin}${location.pathname}?s=${s}`;
      navigator.clipboard?.writeText(url).then(()=>toast('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ú‡∏•‡πÅ‡∏•‡πâ‡∏ß','success'));
    }

    /* ---------- flow ---------- */
    function setProgress(i,total){ const p=Math.round(i/total*100); $('progressBar').style.width=p+'%'; $('progressText').textContent=p+'%'; }
    function start(){ $('welcomeScreen').classList.add('hidden'); $('progressContainer').classList.remove('hidden'); currentStep=0; renderQuestion(); }
    function prev(){ if(currentStep>0){ currentStep--; renderQuestion(); debounce(); } }
    function inputMoney(id,placeholder='0'){ return `<input type="text" id="${id}" data-money class="money w-full px-6 py-4 border-0 rounded-2xl text-xl font-semibold text-gray-800 mono" placeholder="${placeholder}" inputmode="decimal">`; }

    function renderQuestion(){
      const q=questions[currentStep];
      const totalSteps=questions.length+attitudeQuestions.length;
      setProgress(currentStep+1,totalSteps);
      $('questionScreen').classList.remove('hidden');

      if(q.type==='single'){
        $('questionContent').innerHTML=`
          <div class="text-center mb-6">
            <div class="inline-block p-5 bg-gradient-to-br from-purple-100 to-indigo-100 rounded-2xl mb-4"><div class="text-5xl">${q.icon}</div></div>
            <h2 class="text-2xl sm:text-3xl font-bold mb-2 text-gray-800">${q.title}</h2>
            <p class="text-gray-500 font-medium">${q.desc}</p>
          </div>
          <div class="mb-6">${inputMoney('money_single')}</div>
          <div class="flex gap-3">
            ${currentStep>0?'<button id="btnPrev" class="flex-1 px-6 py-4 bg-gray-100 text-gray-700 font-bold rounded-2xl">‚Üê ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>':''}
            <button id="btnNext" class="btn flex-1 px-6 py-4 text-white font-bold rounded-2xl shadow-lg" style="background:linear-gradient(135deg,var(--primary),var(--secondary))">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí</button>
          </div>`;
        const el=$('money_single'); const val=userData[q.field]||0; if(val){ el.value=thb(val); el.dataset.raw=val }
      }else{
        const fields=expenseCategories.map(c=>`
          <div>
            <label class="block text-sm font-bold mb-1 text-gray-700 flex items-center gap-2"><span class="text-2xl">${c.icon}</span>${c.label}${c.need?'<span class="text-[10px] ml-2 px-2 py-[2px] rounded-full bg-emerald-50 text-emerald-600 border border-emerald-200">‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô</span>':''}</label>
            ${inputMoney('ex_'+c.key)}
          </div>`).join('');
        $('questionContent').innerHTML=`
          <div class="text-center mb-5">
            <div class="inline-block p-5 bg-gradient-to-br from-purple-100 to-indigo-100 rounded-2xl mb-4"><div class="text-5xl">${q.icon}</div></div>
            <h2 class="text-2xl sm:text-3xl font-bold mb-2 text-gray-800">${q.title}</h2>
            <p class="text-gray-500 font-medium">${q.desc}</p>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-5">${fields}</div>
          <div class="flex gap-3">
            <button id="btnPrev" class="flex-1 px-6 py-4 bg-gray-100 text-gray-700 font-bold rounded-2xl">‚Üê ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
            <button id="btnNext" class="btn flex-1 px-6 py-4 text-white font-bold rounded-2xl shadow-lg" style="background:linear-gradient(135deg,var(--primary),var(--secondary))">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚Üí</button>
          </div>`;
        expenseCategories.forEach(c=>{ const el=$('ex_'+c.key); const v=userData.expenses[c.key]||0; if(v){ el.value=thb(v); el.dataset.raw=v }});
      }
      const prevBtn=$('btnPrev'); if(prevBtn) prevBtn.onclick=prev;
      $('btnNext').onclick=next;
    }

    function next(){
      const q=questions[currentStep];
      if(q.type==='single'){
        const val=parseMoneyInput($('money_single'));
        if(val<0||isNaN(val)){ toast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á','warn'); return; }
        userData[q.field]=val;
      }else{
        expenseCategories.forEach(c=>{ const el=$('ex_'+c.key); userData.expenses[c.key]=el?parseMoneyInput(el):0; });
      }
      currentStep++; debounce();
      if(currentStep<questions.length){ renderQuestion(); } else { computeCore(); }
      buzz();
    }

    /* ---------- core ---------- */
    function computeCore(){
      const inc=userData.income||0, debt=userData.debtExpense||0;
      const spend=Object.values(userData.expenses||{}).reduce((a,b)=>a+(b||0),0);
      const totalExp=debt+spend;
      const sav=userData.savings||0;

      const dti = inc>0 ? (debt/inc)*100 : 0;
      const efMonths = totalExp>0 ? sav/totalExp : 0;
      const liquidity = inc-totalExp;

      const dti35=inc*0.35, dti45=inc*0.45;
      const needTo35=Math.max(0,debt-dti35);
      const needTo45=Math.max(0,debt-dti45);
      const needTo3m=Math.max(0,3*totalExp-sav);
      const needTo6m=Math.max(0,6*totalExp-sav);

      const offenders=Object.entries(userData.expenses).map(([k,v])=>({k,v,label:(expenseCategories.find(c=>c.key===k)||{}).label||k,need:(expenseCategories.find(c=>c.key===k)||{}).need})).sort((a,b)=>b.v-a.v).filter(x=>x.v>0);

      const dtiStatus=dti<=35?'‡∏î‡∏µ‡∏°‡∏≤‡∏Å':dti<=45?'‡∏£‡∏∞‡∏ß‡∏±‡∏á':'‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢';
      const dtiColor=dti<=35?'#10b981':dti<=45?'#f59e0b':'#ef4444';
      const efStatus=efMonths<3?'‡πÑ‡∏°‡πà‡∏û‡∏≠':efMonths<=6?'‡∏û‡∏≠':'‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏õ‡πâ‡∏≤';
      const efColor=efMonths<3?'#ef4444':efMonths<=6?'#10b981':'#3b82f6';
      const liqStatus=liquidity<0?'‡∏ï‡∏¥‡∏î‡∏•‡∏ö':'‡∏î‡∏µ';
      const liqColor=liquidity<0?'#ef4444':'#10b981';

      const adviceDTI=(()=>{
        if(dti<=35) return [`DTI = ${dti.toFixed(1)}% ‚Üí ‡πÉ‡∏ä‡πâ‡∏´‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡∏™‡∏ö‡∏≤‡∏¢`,`‡∏Å‡∏±‡∏ô‡∏≠‡∏≠‡∏°/‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 20% ‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ (~${thb(inc*0.20)}‡∏ø/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)`,`‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏´‡∏ô‡∏µ‡πâ‡∏î‡∏≠‡∏Å‡∏™‡∏π‡∏á ‡πÉ‡∏´‡πâ‡πÇ‡∏õ‡∏∞‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà‡∏î‡∏≠‡∏Å‡πÅ‡∏û‡∏á‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô`];
        if(dti<=45) return [`DTI = ${dti.toFixed(1)}% (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏∂‡∏á)`,`‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏´‡∏ô‡∏µ‡πâ‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‚â§ ${thb(dti35)}‡∏ø (‡∏Ñ‡∏ß‡∏£‡∏•‡∏î ~${thb(needTo35)}‡∏ø/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)`,`‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î/‡∏£‡∏µ‡πÑ‡∏ü‡πÅ‡∏ô‡∏ô‡∏ã‡πå ‡πÅ‡∏•‡∏∞‡∏´‡∏¢‡∏∏‡∏î‡∏´‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡∏°‡πà‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß`];
        return [`DTI = ${dti.toFixed(1)}% (‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ)`,`‡∏î‡πà‡∏ß‡∏ô: ‡∏•‡∏î‡∏•‡∏á‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ 45% (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ ~${thb(needTo45)}‡∏ø/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô) ‡πÅ‡∏•‡∏∞‡∏°‡∏∏‡πà‡∏á‡πÑ‡∏õ 35% (~${thb(needTo35)}‡∏ø/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)`,`‡πÄ‡∏à‡∏£‡∏à‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á/‡∏£‡∏ß‡∏°‡∏´‡∏ô‡∏µ‡πâ + ‡∏á‡∏î‡∏Å‡πà‡∏≠‡∏´‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡∏°‡πà`];
      })();

      const adviceEF=(()=>{
        if(liquidity<0){
          return [`‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏•‡∏ö ~${thb(Math.abs(liquidity))}‡∏ø/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô`,`‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏±‡πâ‡∏á‡∏≠‡∏≠‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ ‡πÉ‡∏´‡πâ‡πÅ‡∏Å‡πâ‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡πÉ‡∏´‡πâ ‚â• 0 ‡∏Å‡πà‡∏≠‡∏ô`,`‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô/‡∏Ñ‡∏∏‡∏¢‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á`];
        }
        if(efMonths<3) return [`‡πÄ‡∏á‡∏¥‡∏ô‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô ${efMonths.toFixed(1)} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏≠)`,`‡∏ï‡∏±‡πâ‡∏á‡πÇ‡∏≠‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ ${thb(Math.max(1000,Math.round((needTo3m/6)/100)*100))}‡∏ø/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô`,`‡∏ñ‡∏∂‡∏á 3 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡πà‡∏≠‡∏¢‡πÑ‡∏ï‡πà‡πÑ‡∏õ 6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏Ç‡∏≤‡∏î ~${thb(needTo6m)}‡∏ø)`];
        if(efMonths<=6) return [`‡πÄ‡∏á‡∏¥‡∏ô‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô ${efMonths.toFixed(1)} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏û‡∏≠‡πÉ‡∏ä‡πâ)`,`‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏£‡∏∞‡∏î‡∏±‡∏ö 3‚Äì6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÉ‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏™‡∏π‡∏á`,`‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ñ‡πà‡∏≠‡∏¢‡πÇ‡∏¢‡∏Å‡πÑ‡∏õ‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡πÅ‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (DCA)`];
        return [`‡πÄ‡∏á‡∏¥‡∏ô‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô ${efMonths.toFixed(1)} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏õ‡πâ‡∏≤)`,`‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô ~${thb(Math.max(0,sav-6*totalExp))}‡∏ø ‚Üí ‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ`,`‡∏Ñ‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô‡πÑ‡∏ß‡πâ ~6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πá‡∏û‡∏≠`];
      })();

      const adviceLIQ=(()=>{
        if(liquidity<0){
          const gap=Math.abs(liquidity);
          const cuts=offenders.filter(e=>!e.need).slice(0,3).map((e,i)=>`${i+1}. ${e.label} ‡∏•‡∏î 10‚Äì15% (~${thb(e.v*0.10)}‚Äì${thb(e.v*0.15)}‡∏ø)`).join(' ‚Ä¢ ');
          return [`‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏•‡∏ö ~${thb(gap)}‡∏ø/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô`,cuts||`‡∏ï‡∏±‡∏î‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô 10‚Äì15% ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß`,dti>45?`‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏π‡πà: ‡πÄ‡∏à‡∏£‡∏à‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏ô‡∏µ‡πâ‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô`:`‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ`];
        }
        const to6m=Math.max(0,6*totalExp-sav);
        const efAlloc=Math.min(liquidity,to6m);
        const investAlloc=Math.max(0,liquidity-efAlloc);
        return [`‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏ö‡∏ß‡∏Å ~${thb(liquidity)}‡∏ø/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô`,`‡πÅ‡∏ö‡πà‡∏á: ‡πÄ‡∏ï‡∏¥‡∏°‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô ~${thb(efAlloc)}‡∏ø/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô`,`‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ~${thb(investAlloc)}‡∏ø/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‚Üí ‡∏•‡∏á‡∏ó‡∏∏‡∏ô‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠`];
      })();

      userData.results={ inc,debt,spend,totalExp,sav,dti,efMonths,liquidity,
        dtiStatus,dtiColor,efStatus,efColor,liqStatus,liqColor,
        needTo35,needTo45,needTo3m,needTo6m,offenders,
        advice:{dti:adviceDTI,ef:adviceEF,liq:adviceLIQ}
      };
      debounce();
      renderAttitude();
    }

    /* ---------- attitude ---------- */
    function renderAttitude(){
      $('questionScreen').classList.add('hidden');
      $('attitudeScreen').classList.remove('hidden');
      currentAttitudeQuestion=0; userData.attitudeAnswers=[];
      showAttitudeQ();
    }
    function setProgressAtt(){ setProgress(questions.length+currentAttitudeQuestion+1,questions.length+attitudeQuestions.length); }
    function showAttitudeQ(){
      const q=attitudeQuestions[currentAttitudeQuestion]; setProgressAtt();
      const opts=q.opts.map((o,i)=>`<button class="btn w-full text-left px-6 py-4 bg-gradient-to-r from-gray-50 to-gray-100 rounded-2xl border-2 border-gray-200 hover:border-indigo-400 font-semibold text-gray-800 shadow-sm" data-ans="${i}">
        <span class="flex items-center gap-3"><span class="text-2xl">‚Ä¢</span><span>${o.t}</span></span></button>`).join('');
      $('attitudeContent').innerHTML=`
        <div class="text-center mb-6">
          <div class="inline-block p-5 bg-gradient-to-br from-yellow-100 to-orange-100 rounded-2xl mb-4"><div class="text-5xl">ü§î</div></div>
          <div class="inline-block px-3 py-1 bg-purple-100 rounded-full mb-3 text-purple-700 text-sm font-bold">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà ${currentAttitudeQuestion+1}/${attitudeQuestions.length}</div>
          <p class="text-xl text-gray-800 font-bold leading-relaxed max-w-lg mx-auto">${q.q}</p>
        </div>
        <div class="grid gap-3">${opts}</div>`;
      $('attitudeContent').querySelectorAll('[data-ans]').forEach(b=> b.onclick=()=>selectAtt(parseInt(b.dataset.ans,10)));
    }
    function selectAtt(i){
      const q=attitudeQuestions[currentAttitudeQuestion], sel=q.opts[i];
      userData.attitudeAnswers.push({ id:q.id, q:q.q, a:sel.t, ok:sel.ok, tip: sel.ok ? q.tipOK : q.tipNG });
      currentAttitudeQuestion++;
      if(currentAttitudeQuestion<attitudeQuestions.length){ showAttitudeQ(); } else { renderFinal(); }
      buzz();
    }

    /* ---------- final + sim ---------- */
    function ring(el,pct,color,label,valueText){
      const R=54,C=2*Math.PI*R,p=Math.max(0,Math.min(100,pct));
      el.innerHTML=`<div class="p-4 rounded-2xl bg-white/90 border border-white/60 shadow text-center">
        <svg width="140" height="140" viewBox="0 0 140 140" class="mx-auto block">
          <circle cx="70" cy="70" r="${R}" stroke="#e5e7eb" stroke-width="14" fill="none"/>
          <circle cx="70" cy="70" r="${R}" stroke="${color}" stroke-linecap="round" stroke-width="14" fill="none" class="ring" style="stroke-dasharray:${C};stroke-dashoffset:${C};transform:rotate(-90deg);transform-origin:50% 50%"/>
          <text x="50%" y="50%" text-anchor="middle" dy="8" font-size="22" font-weight="800" fill="${color}">${valueText}</text>
        </svg>
        <div class="mt-2 font-bold text-gray-800">${label}</div>
      </div>`;
      requestAnimationFrame(()=>{ el.querySelectorAll('circle')[1].style.strokeDashoffset=C*(1 - p/100); });
    }
    const bList = lines => `<ul class="list-disc list-inside text-gray-700 leading-relaxed">${lines.map(x=>`<li>${x}</li>`).join('')}</ul>`;

    function editableCapTable(initCaps,data){
      const rows = expenseCategories
        .filter(c => (data.expenses[c.key]||0)>0 || (initCaps[c.key]||0)>0)
        .map(c=>{
          const now=data.expenses[c.key]||0;
          const rec=initCaps[c.key]??now;
          return `<tr class="text-sm">
            <td class="py-2">${c.icon} ${c.label}${c.need?'<span class="text-[10px] ml-2 px-2 py-[2px] rounded-full bg-emerald-50 text-emerald-600 border border-emerald-200">‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô</span>':''}</td>
            <td class="py-2 text-right mono">${thb(now)}</td>
            <td class="py-2 text-right"><input data-money data-cap="${c.key}" class="money w-28 px-2 py-1 rounded-lg border text-right" value="${thb(rec)}" /></td>
            <td class="py-2 text-right mono" id="diff_${c.key}"></td>
          </tr>`;
        }).join('');
      return `<table class="w-full"><thead>
        <tr class="text-xs text-gray-500 border-b">
          <th class="py-2 text-left">‡∏´‡∏°‡∏ß‡∏î</th><th class="py-2 text-right">‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</th><th class="py-2 text-right">‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡∏°‡πà (‡πÉ‡∏™‡πà‡πÄ‡∏≠‡∏á)</th><th class="py-2 text-right">‡∏™‡πà‡∏ß‡∏ô‡∏ï‡πà‡∏≤‡∏á</th>
        </tr></thead><tbody>${rows}</tbody></table>
        <p class="text-xs text-gray-500 mt-2">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ ‚Äú‡∏Ñ‡πà‡∏≠‡∏¢‡πÜ ‡∏•‡∏î‚Äù 10‚Äì20% ‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡πà‡∏≠‡∏ô</p>
        <div class="mt-3 text-sm p-3 rounded-xl border bg-white" id="planSummary"></div>`;
    }

    function renderFinal(){
      $('attitudeScreen').classList.add('hidden');
      $('progressContainer').classList.add('hidden');
      $('finalScreen').classList.remove('hidden');

      const R=userData.results;
      const row=document.createElement('div'); row.id='ringRow'; row.className='grid grid-cols-1 sm:grid-cols-3 gap-3 my-4';

      const baseShare={food:.15,transport:.10,household:.06,utilities:.07,entertainment:.05,clothing:.03,internet:.03,other:.06};
      const floors={food:3000,transport:800,utilities:500};
      const spendShareNow=(R.spend/R.inc)||.55;
      const targetSpendShare=Math.min(.65,Math.max(.50,spendShareNow));
      const initCaps={};
      Object.entries(baseShare).forEach(([k,v])=>{
        const now=userData.expenses[k]||0;
        if(now===0){ initCaps[k]=0; return; }
        let cap=Math.round(R.inc*(v/0.55)*targetSpendShare);
        if(floors[k]) cap=Math.max(cap,floors[k]);
        const stepFloor=Math.round(now*0.8);
        initCaps[k]=Math.min(now,Math.max(cap,stepFloor));
      });

      $('finalContent').innerHTML=`
        <div class="text-center mb-2">
          <div class="inline-block p-5 bg-gradient-to-br from-green-100 to-emerald-100 rounded-2xl mb-3"><div class="text-5xl">‚ú®</div></div>
          <h2 class="text-2xl sm:text-3xl font-extrabold" style="-webkit-background-clip:text;-webkit-text-fill-color:transparent;background:linear-gradient(135deg,var(--primary),var(--secondary))">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ ‡∏ó‡∏≥‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á)</h2>
          <p class="text-gray-500">‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
        </div>
        <div id="ringRow" class="${row.className}"></div>

        <div class="grid gap-4">
          <div class="bg-gradient-to-br from-white to-gray-50 border-l-4 rounded-2xl p-5 shadow" style="border-color:${R.dtiColor}">
            <div class="flex items-center justify-between mb-2">
              <h3 class="text-lg font-bold">‡∏†‡∏≤‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ (DTI)</h3>
              <span class="px-3 py-1 text-xs rounded-full text-white" style="background:${R.dtiColor}">${R.dtiStatus}</span>
            </div>
            <div class="text-3xl font-extrabold mb-1" style="color:${R.dtiColor}">${R.dti.toFixed(1)}%</div>
            ${bList(R.advice.dti)}
          </div>

          <div class="bg-gradient-to-br from-white to-gray-50 border-l-4 rounded-2xl p-5 shadow" style="border-color:${R.efColor}">
            <div class="flex items-center justify-between mb-2">
              <h3 class="text-lg font-bold">‡πÄ‡∏á‡∏¥‡∏ô‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô</h3>
              <span class="px-3 py-1 text-xs rounded-full text-white" style="background:${R.efColor}">${R.efStatus}</span>
            </div>
            <div class="text-3xl font-extrabold mb-1" style="color:${R.efColor}">${R.efMonths.toFixed(1)} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
            ${bList(R.advice.ef)}
          </div>

          <div class="bg-gradient-to-br from-white to-gray-50 border-l-4 rounded-2xl p-5 shadow" style="border-color:${R.liqColor}">
            <div class="flex items-center justify-between mb-2">
              <h3 class="text-lg font-bold">‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h3>
              <span class="px-3 py-1 text-xs rounded-full text-white" style="background:${R.liqColor}">${R.liqStatus}</span>
            </div>
            <div class="text-3xl font-extrabold mb-1" style="color:${R.liqColor}">${thb(R.liquidity)} ‡∏ø</div>
            ${bList(R.advice.liq)}
          </div>

          <!-- ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡∏°‡πà (‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏≠‡∏á) -->
          <div class="bg-white rounded-2xl p-5 border">
            <div class="flex items-center gap-2 mb-2"><span class="text-2xl">üß≠</span><h3 class="text-lg font-bold">‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏´‡∏°‡∏ß‡∏î (‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏≠‡∏á)</h3></div>
            ${editableCapTable(initCaps,userData)}
          </div>
        </div>

        <!-- What-if -->
        <div class="bg-white/90 border rounded-2xl p-5 shadow mt-4">
          <div class="flex items-center gap-2 mb-2"><span class="text-2xl">üß™</span><h3 class="text-lg font-bold">‡∏•‡∏≠‡∏á‡∏Ç‡∏¢‡∏±‡∏ö ‡πÅ‡∏•‡πâ‡∏ß‡∏î‡∏π‡∏ú‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</h3></div>
          <div class="grid-auto">
            <div>
              <label class="block text-sm font-semibold mb-1">‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ Top 3 (‡∏´‡∏°‡∏ß‡∏î‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)</label>
              <input id="simCut" type="range" min="0" max="40" step="1" value="15" class="w-full">
              <div class="text-xs text-gray-600">‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ: <span id="simCutVal" class="mono">15%</span></div>
            </div>
            <div>
              <label class="block text-sm font-semibold mb-1">‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î‡∏´‡∏ô‡∏µ‡πâ/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡πÄ‡∏à‡∏£‡∏à‡∏≤/‡∏£‡∏µ‡πÑ‡∏ü‡πÅ‡∏ô‡∏ô‡∏ã‡πå)</label>
              <input id="simDebt" type="range" min="0" max="50" step="1" value="10" class="w-full">
              <div class="text-xs text-gray-600">‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ: <span id="simDebtVal" class="mono">10%</span> ‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ (<span id="simDebtBaht" class="mono"></span>‡∏ø)</div>
            </div>
            <div>
              <label class="block text-sm font-semibold mb-1">‡∏≠‡∏≠‡∏°‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</label>
              <input id="simEF" type="range" min="0" max="30" step="1" value="10" class="w-full">
              <div class="text-xs text-gray-600">‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ: <span id="simEFVal" class="mono">10%</span> ‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ (<span id="simEFBaht" class="mono"></span>‡∏ø)</div>
            </div>
          </div>
          <div id="simResult" class="grid grid-cols-1 sm:grid-cols-3 gap-3 mt-4"></div>
          <div id="simAdvice" class="text-sm text-gray-700 leading-relaxed mt-3"></div>
        </div>

        <div class="grid gap-3 sm:grid-cols-2 mt-5">
          <button id="btnRestart" class="btn px-6 py-4 rounded-2xl text-white font-bold" style="background:linear-gradient(135deg,var(--primary),var(--secondary))">üîÑ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</button>
          <button id="btnShare" class="btn px-6 py-4 rounded-2xl font-semibold bg-white border">üîó ‡πÅ‡∏ä‡∏£‡πå‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</button>
        </div>
      `;

      // rings
      const a=document.createElement('div'),b=document.createElement('div'),c=document.createElement('div'); $('ringRow').append(a,b,c);
      const dtiPct=Math.max(0,100-Math.min(100,R.dti));
      const efPct=Math.min(100,(R.efMonths/6)*100);
      const liqPct=R.liquidity<=0?0:Math.min(100,(R.liquidity/(R.inc||1))*100);
      ring(a,dtiPct,R.dtiColor,'DTI (‡∏¢‡∏¥‡πà‡∏á‡∏°‡∏≤‡∏Å‡∏¢‡∏¥‡πà‡∏á‡∏î‡∏µ)',`${dtiPct.toFixed(0)}%`);
      ring(b,efPct,R.efColor,'‡πÄ‡∏á‡∏¥‡∏ô‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô',`${R.efMonths.toFixed(1)}‡∏î.`);
      ring(c,liqPct,R.liqColor,'‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á/‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ',`${liqPct.toFixed(0)}%`);

      /* ---- editable plan logic ---- */
      function recalcPlan(){
        // collect targets
        const targets={}; let newSpend=0;
        expenseCategories.forEach(c=>{
          const now=userData.expenses[c.key]||0;
          const inp=document.querySelector(`[data-cap="${c.key}"]`);
          let t=now;
          if(inp){ t=parseMoneyInput(inp); }
          targets[c.key]=Math.max(0,Math.min(now,t)); // ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏•‡∏î‡∏Å‡πà‡∏≠‡∏ô ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô)
          newSpend += targets[c.key];
          const diffEl=$(`diff_${c.key}`); if(diffEl){ const diff=targets[c.key]-now; diffEl.style.color = diff<=0?'#10b981':'#ef4444'; diffEl.textContent = (diff<=0?'':'+')+thb(diff); }
        });

        const newTotal=newSpend + R.debt;
        const newLiq = R.inc - newTotal;
        const newDTI = R.inc>0 ? (R.debt/R.inc)*100 : 0;

        const planBox=$('planSummary');
        const stillNeg = newLiq < 0;
        planBox.innerHTML = `
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-2">
            <div><div class="text-xs text-gray-500">‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà (‡∏£‡∏ß‡∏°‡∏´‡∏°‡∏ß‡∏î)</div><div class="mono font-extrabold">${thb(newSpend)} ‡∏ø</div></div>
            <div><div class="text-xs text-gray-500">DTI (‡πÄ‡∏ó‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏° ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î)</div><div class="mono font-extrabold">${newDTI.toFixed(1)}%</div></div>
            <div><div class="text-xs text-gray-500">‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå</div><div class="mono font-extrabold" style="color:${stillNeg?'#ef4444':'#10b981'}">${thb(newLiq)} ‡∏ø</div></div>
          </div>
          <div class="mt-2 ${stillNeg?'text-rose-700':'text-emerald-700'} text-sm">
            ${stillNeg? '‡∏¢‡∏±‡∏á‡∏ï‡∏¥‡∏î‡∏•‡∏ö‡∏≠‡∏¢‡∏π‡πà ‚Üí ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤ ‚Äú‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î‡∏´‡∏ô‡∏µ‡πâ/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‚Äù ‡πÇ‡∏î‡∏¢‡πÄ‡∏à‡∏£‡∏à‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á/‡∏£‡∏µ‡πÑ‡∏ü‡πÅ‡∏ô‡∏ô‡∏ã‡πå ‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏£‡∏±‡∏ö‡∏´‡∏°‡∏ß‡∏î‡∏≠‡∏∑‡πà‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°' : '‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‚Üí ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏±‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô‡∏ï‡∏≤‡∏°‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ'}
          </div>`;
        userData.planTargets=targets; userData.planLiq=newLiq; debounce();
      }
      document.querySelectorAll('[data-cap]').forEach(el=> el.addEventListener('input',recalcPlan));
      recalcPlan();

      /* ---- sim logic (‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î‡πÅ‡∏ó‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°) ---- */
      const simCut=$('simCut'), simDebt=$('simDebt'), simEF=$('simEF');
      const simCutVal=$('simCutVal'), simDebtVal=$('simDebtVal'), simEFVal=$('simEFVal');
      const simDebtBaht=$('simDebtBaht'), simEFBaht=$('simEFBaht');

      function syncLabels(){
        simCutVal.textContent=simCut.value+'%';
        simDebtVal.textContent=simDebt.value+'%';
        simEFVal.textContent=simEF.value+'%';
        simDebtBaht.textContent=thb(R.inc*(simDebt.value/100));
        simEFBaht.textContent=thb(R.inc*(simEF.value/100));
      }

      function runSim(){
        const cutPct=Number(simCut.value)/100;
        const reduceDebt = R.inc * (Number(simDebt.value)/100); // ‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
        const saveEF = R.inc * (Number(simEF.value)/100);

        let spendNew=R.spend;
        const top3=[...R.offenders].filter(e=>!e.need).slice(0,3);
        top3.forEach(t=> spendNew -= t.v*cutPct);
        spendNew=Math.max(0,spendNew);

        const debtNew=Math.max(0,R.debt - reduceDebt);
        const totalNew=spendNew + debtNew;
        const dtiNew= R.inc>0 ? (debtNew/R.inc)*100 : 0;
        const liqNew = R.inc - totalNew - Math.min(saveEF, Math.max(0, 6*totalNew - (R.sav)));
        const efMonthsNew = (R.sav + saveEF) / (totalNew>0? totalNew:1);

        const card=(label,val,sub,color)=>`
          <div class="rounded-xl border p-4 text-center" style="border-color:${color}">
            <div class="text-xs text-gray-500 mb-1">${label}</div>
            <div class="text-2xl font-extrabold mono" style="color:${color}">${val}</div>
            <div class="text-xs text-gray-500 mt-1">${sub}</div>
          </div>`;
        $('simResult').innerHTML=[
          card('DTI ‡πÉ‡∏´‡∏°‡πà', dtiNew.toFixed(1)+'%', `‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á: ${(R.dti-dtiNew).toFixed(1)} ‡∏à‡∏∏‡∏î`, '#6366f1'),
          card('‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô (‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)', efMonthsNew.toFixed(1)+' ‡∏î.', `‡∏≠‡∏≠‡∏°/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: ${thb(saveEF)}‡∏ø`, '#10b981'),
          card('‡∏™‡∏†‡∏≤‡∏û‡∏Ñ‡∏•‡πà‡∏≠‡∏á‡∏™‡∏∏‡∏ó‡∏ò‡∏¥', `${thb(liqNew)}‡∏ø`, `‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏±‡∏ô‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô ${thb(saveEF)}‡∏ø`, liqNew>=0?'#10b981':'#ef4444')
        ].join('');

        const needTo35New=Math.max(0, debtNew - (R.inc*0.35));
        const monthsTo3m = R.needTo3m>0 && saveEF>0 ? Math.ceil(R.needTo3m / saveEF) : 0;

        $('simAdvice').innerHTML=`
          <div class="grid-auto mt-1">
            <div class="bg-white rounded-lg p-3 border"><div class="font-semibold mb-1">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ DTI 35%</div>
              ${needTo35New<=0?'<div class="text-sm text-green-700">‚úÖ ‡πÅ‡∏ï‡∏∞ ‚â§35% ‡πÅ‡∏•‡πâ‡∏ß</div>':
              `<div class="text-sm">‡∏¢‡∏±‡∏á‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏î‡∏Ñ‡πà‡∏≤‡∏á‡∏ß‡∏î‡∏≠‡∏µ‡∏Å <span class="chip mono">${thb(needTo35New)}‡∏ø/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span></div>`}
            </div>
            <div class="bg-white rounded-lg p-3 border"><div class="font-semibold mb-1">‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô 3 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
              ${R.needTo3m<=0?'<div class="text-sm text-green-700">‚úÖ ‡∏Ñ‡∏£‡∏ö ‚â•3 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß</div>':
              saveEF<=0?'<div class="text-sm text-amber-700">‡∏ï‡∏±‡πâ‡∏á‡∏≠‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô</div>':
              `<div class="text-sm">‡∏Ñ‡∏≤‡∏î ~<span class="chip mono">${monthsTo3m} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span> ‡∏´‡∏≤‡∏Å‡∏≠‡∏≠‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏•‡∏∞ <span class="chip mono">${thb(saveEF)}‡∏ø</span></div>`}
            </div>
            <div class="bg-white rounded-lg p-3 border"><div class="font-semibold mb-1">‡∏ú‡∏•‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢</div>
              <div class="text-sm">‡∏ï‡∏±‡∏î Top3 (‡∏´‡∏°‡∏ß‡∏î‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô) ~<span class="chip mono">${simCut.value}%</span> ‚Üí ‡∏•‡∏î‡∏£‡∏ß‡∏° ~<span class="chip mono">${thb(R.offenders.filter(e=>!e.need).slice(0,3).reduce((s,x)=>s+x.v*(cutPct),0))}‡∏ø/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span></div>
            </div>
          </div>`;
        userData.sim={cutPct,reduceDebt,saveEF,dtiNew,efMonthsNew,liqNew}; debounce();
      }
      [simCut,simDebt,simEF].forEach(el=> el.addEventListener('input', ()=>{syncLabels();runSim();}));
      syncLabels(); runSim();

      $('btnRestart').onclick=()=>{ userData={income:0,debtExpense:0,expenses:{},savings:0,attitudeAnswers:[]}; currentStep=0; $('finalScreen').classList.add('hidden'); $('welcomeScreen').classList.remove('hidden'); $('progressBar').style.width='0%'; saveState(); };
      $('btnShare').onclick=shareResult;
    }

    /* ---------- init ---------- */
    document.addEventListener('DOMContentLoaded',()=>{
      const has=loadState();
      const btnStart=$('btnStart'), btnResume=$('btnResume');
      btnStart.onclick=()=>{ $('progressContainer').classList.remove('hidden'); start(); };
      if(has){ btnResume.classList.remove('hidden'); btnResume.onclick=()=>{ if(userData.results){ renderFinal(); } else { $('progressContainer').classList.remove('hidden'); start(); } toast('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Å‡πà‡∏≠‡∏ô‡πÅ‡∏•‡πâ‡∏ß','success'); }; }
    });
  </script>
</body>
</html>
